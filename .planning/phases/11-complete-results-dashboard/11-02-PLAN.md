---
phase: 11-complete-results-dashboard
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/results-dashboard.ts
  - src/simulation/types.ts
autonomous: true

must_haves:
  truths:
    - "CAGR displayed in statistics panel"
    - "TWRR displayed in statistics panel"
    - "Annualized volatility displayed"
    - "Salary equivalent displayed"
  artifacts:
    - path: "src/components/ui/results-dashboard.ts"
      provides: "Extended statistics display"
      contains: "stat-cagr"
  key_links:
    - from: "results-dashboard.ts"
      to: "calculations module"
      via: "calculateCAGR, calculateTWRR"
      pattern: "import.*from.*calculations"
---

<objective>
Add extended financial statistics to the results dashboard: CAGR, TWRR, annualized volatility, and salary-equivalent.

Purpose: Display industry-standard financial metrics that users expect for strategy evaluation.
Output: Statistics panel shows 8 metrics instead of 4.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing results dashboard
@src/components/ui/results-dashboard.ts

# Calculation functions to use
@src/calculations/index.ts
@src/calculations/metrics.ts
@src/calculations/twrr.ts
@src/calculations/salary-equivalent.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend SimulationStatistics type with additional metrics</name>
  <files>src/simulation/types.ts</files>
  <action>
    1. Add optional extended fields to SimulationStatistics interface:
       ```typescript
       export interface SimulationStatistics {
         // Existing
         mean: number;
         median: number;
         stddev: number;
         successRate: number;
         // Extended (computed post-simulation)
         cagr?: number;
         twrr?: number;
         annualizedVolatility?: number;
       }
       ```
    2. These are optional because they're computed in the UI layer, not the worker
  </action>
  <verify>npm run build succeeds</verify>
  <done>SimulationStatistics type extended with optional CAGR, TWRR, volatility fields</done>
</task>

<task type="auto">
  <name>Task 2: Compute extended statistics in results dashboard</name>
  <files>src/components/ui/results-dashboard.ts</files>
  <action>
    1. Import calculation functions:
       ```typescript
       import {
         calculateCAGR,
         calculateAnnualizedVolatility,
         calculateTWRR,
         calculateSalaryEquivalent,
       } from '../../calculations';
       ```
    2. Add new state properties for extended stats:
       ```typescript
       private _initialValue: number = 1000000;
       private _timeHorizon: number = 30;
       private _annualWithdrawal: number = 50000; // default SBLOC draw
       private _effectiveTaxRate: number = 0.37;
       ```
    3. Add setters for these values so app-root can provide them
    4. Create `computeExtendedStats()` method:
       ```typescript
       private computeExtendedStats(): {
         cagr: number;
         twrr: number;
         volatility: number;
         salaryEquivalent: { equivalent: number; taxSavings: number };
       } | null {
         if (!this._data) return null;

         const terminalValues = Array.from(this._data.terminalValues);
         const { median } = this._data.statistics;

         // CAGR from median terminal value
         const cagr = calculateCAGR(this._initialValue, median, this._timeHorizon);

         // Annualized volatility from terminal values
         const volatility = calculateAnnualizedVolatility(
           terminalValues,
           this._initialValue,
           this._timeHorizon
         );

         // TWRR from yearly percentiles (median path)
         const medianPath = this._data.yearlyPercentiles.map(y => y.p50);
         const twrrResult = calculateTWRR([this._initialValue, ...medianPath]);
         const twrr = twrrResult.twrr;

         // Salary equivalent for tax-free SBLOC withdrawal
         const salaryResult = calculateSalaryEquivalent(
           this._annualWithdrawal,
           this._effectiveTaxRate
         );

         return { cagr, twrr, volatility, salaryEquivalent: {
           equivalent: salaryResult.salaryEquivalent,
           taxSavings: salaryResult.taxSavings
         }};
       }
       ```
  </action>
  <verify>npm run build succeeds</verify>
  <done>Extended statistics computation logic implemented</done>
</task>

<task type="auto">
  <name>Task 3: Update statistics panel UI with extended metrics</name>
  <files>src/components/ui/results-dashboard.ts</files>
  <action>
    1. Expand stats-grid template to 2 rows of 4 stats each:
       ```html
       <div class="stats-grid" id="stats-grid">
         <!-- Row 1: Core stats -->
         <div class="stat-item">
           <span class="stat-label">Median Value</span>
           <span class="stat-value" id="stat-median">-</span>
         </div>
         <div class="stat-item">
           <span class="stat-label">Success Rate</span>
           <span class="stat-value" id="stat-success">-</span>
         </div>
         <div class="stat-item">
           <span class="stat-label">CAGR</span>
           <span class="stat-value" id="stat-cagr">-</span>
         </div>
         <div class="stat-item">
           <span class="stat-label">TWRR</span>
           <span class="stat-value" id="stat-twrr">-</span>
         </div>
         <!-- Row 2: Additional stats -->
         <div class="stat-item">
           <span class="stat-label">Mean Value</span>
           <span class="stat-value" id="stat-mean">-</span>
         </div>
         <div class="stat-item">
           <span class="stat-label">Volatility</span>
           <span class="stat-value" id="stat-volatility">-</span>
         </div>
         <div class="stat-item">
           <span class="stat-label">Std Deviation</span>
           <span class="stat-value" id="stat-stddev">-</span>
         </div>
         <div class="stat-item">
           <span class="stat-label">Salary Equiv.</span>
           <span class="stat-value" id="stat-salary">-</span>
         </div>
       </div>
       ```
    2. Update CSS: Change `.stats-grid` to `grid-template-columns: repeat(4, 1fr)` for desktop
    3. Add mobile override: `@media (max-width: 768px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }`
    4. Update updateStats() method to populate new fields:
       ```typescript
       private updateStats(stats: SimulationStatistics): void {
         const extended = this.computeExtendedStats();
         // ... existing formatting ...

         // Extended stats
         const cagr = this.$('#stat-cagr');
         const twrr = this.$('#stat-twrr');
         const volatility = this.$('#stat-volatility');
         const salary = this.$('#stat-salary');

         if (extended) {
           if (cagr) cagr.textContent = `${(extended.cagr * 100).toFixed(1)}%`;
           if (twrr) twrr.textContent = `${(extended.twrr * 100).toFixed(1)}%`;
           if (volatility) volatility.textContent = `${(extended.volatility * 100).toFixed(1)}%`;
           if (salary) salary.textContent = format(extended.salaryEquivalent.equivalent);
         }
       }
       ```
  </action>
  <verify>npm run build succeeds</verify>
  <done>Statistics panel displays 8 metrics in responsive grid</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run dev` and run simulation
- [ ] CAGR displays as percentage (e.g., "7.2%")
- [ ] TWRR displays as percentage
- [ ] Volatility displays as percentage
- [ ] Salary equivalent displays as currency
- [ ] Mobile view shows 2x4 grid (2 columns, 4 rows)
</verification>

<success_criteria>
- All tasks completed
- 8 statistics displayed after simulation
- CAGR, TWRR, volatility values are reasonable (positive, <50%)
- Salary equivalent shows pre-tax salary needed for equivalent income
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-complete-results-dashboard/11-02-SUMMARY.md`
</output>
