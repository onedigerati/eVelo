---
phase: 11-complete-results-dashboard
plan: 11
type: execute
wave: 4
depends_on: ["11-07"]
files_modified:
  - src/charts/comparison-line-chart.ts
  - src/charts/cumulative-costs-chart.ts
  - src/charts/terminal-comparison-chart.ts
  - src/charts/sbloc-utilization-chart.ts
  - src/charts/index.ts
  - src/components/ui/results-dashboard.ts
autonomous: true

must_haves:
  truths:
    - "Net Worth Over Time chart compares BBD vs Sell median trajectories"
    - "Cumulative Costs chart shows Taxes vs Interest over time"
    - "Terminal Distribution chart shows BBD vs Sell at each percentile"
  artifacts:
    - path: "src/charts/comparison-line-chart.ts"
      provides: "ComparisonLineChart component"
      contains: "Buy Borrow Die"
    - path: "src/charts/cumulative-costs-chart.ts"
      provides: "CumulativeCostsChart component"
      contains: "Cumulative"
---

<objective>
Add enhanced strategy comparison charts for BBD vs Sell visualization.

Purpose: Visual comparison of strategies over time and across percentiles.
Output: Four new chart components showing different comparison perspectives.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/11-complete-results-dashboard/GAPS-PLAN.md
@references/screenshots-ui/MonteCarlo-result-panel-6.png

Reference shows:
1. Net Worth Over Time (Median) - Two lines (BBD green, Sell blue)
2. Cumulative Costs: Taxes vs Interest - Area chart
3. Terminal Value Distribution (All Percentiles) - Grouped bars at P10/P25/P50/P75/P90
</context>

<tasks>
- task: "Create ComparisonLineChart component"
  file: "src/charts/comparison-line-chart.ts"
  action: "create"
  details: |
    Chart.js line chart comparing two strategies over time:

    Props:
    - data: {
        labels: string[],  // Years
        bbdValues: number[],  // BBD median net worth
        sellValues: number[]  // Sell median net worth
      }

    Features:
    - Two lines: BBD (teal/green), Sell (blue)
    - Fill between lines to show difference
    - Legend showing both strategies
    - Y-axis: Currency formatting
    - X-axis: Years
    - Tooltips showing both values

    Styling:
    - Smooth curves (tension: 0.4)
    - Point markers on hover
    - Grid lines
    - Responsive

- task: "Create CumulativeCostsChart component"
  file: "src/charts/cumulative-costs-chart.ts"
  action: "create"
  details: |
    Chart.js area chart comparing cumulative costs:

    Props:
    - data: {
        labels: string[],  // Years
        taxes: number[],   // Sell strategy cumulative taxes
        interest: number[] // BBD cumulative interest
      }

    Features:
    - Two filled areas: Taxes (red/coral), Interest (green)
    - Semi-transparent fills
    - Legend
    - Y-axis: Currency
    - Tooltips showing cost difference

    Styling:
    - Stacked appearance
    - Smooth curves
    - Clear color distinction

- task: "Create TerminalComparisonChart component"
  file: "src/charts/terminal-comparison-chart.ts"
  action: "create"
  details: |
    Chart.js grouped bar chart for terminal values:

    Props:
    - data: {
        percentiles: string[],  // ['10th', '25th', '50th', '75th', '90th']
        bbdValues: number[],
        sellValues: number[]
      }

    Features:
    - Grouped bars at each percentile
    - BBD (green) and Sell (blue) side by side
    - Legend
    - Y-axis: Currency
    - Bar labels showing values

    Styling:
    - Rounded bar corners
    - Clear gap between groups
    - Responsive width

- task: "Create SBLOCUtilizationChart component"
  file: "src/charts/sbloc-utilization-chart.ts"
  action: "create"
  details: |
    Chart.js line chart showing SBLOC usage % with percentile bands:

    Props:
    - data: {
        labels: string[],  // Years
        p10: number[],
        p25: number[],
        p50: number[],
        p75: number[],
        p90: number[],
        maxBorrowing: number  // e.g., 65%
      }

    Features:
    - Percentile lines (P10, P25, P50, P75, P90)
    - Fill between bands
    - Reference line at maxBorrowing
    - Y-axis: Percentage (0-200%+)
    - Legend for percentiles

    Styling:
    - Color gradient from red (P10) to green (P90)
    - Dashed line for max borrowing limit
    - Semi-transparent fills between bands

- task: "Export charts"
  file: "src/charts/index.ts"
  action: "modify"
  details: |
    Export all new chart components

- task: "Integrate into results-dashboard"
  file: "src/components/ui/results-dashboard.ts"
  action: "modify"
  details: |
    Add "Visual Comparison" section in strategy analysis:
    - comparison-line-chart (Net Worth Over Time)
    - cumulative-costs-chart (Taxes vs Interest)
    - terminal-comparison-chart (Terminal Distribution)
    - sbloc-utilization-chart (SBLOC Usage %)

    Calculate sell strategy trajectory using sell-strategy.ts.
    Calculate utilization percentiles from SBLOC data.
</tasks>

<verification>
After completion:
- [ ] `npm run build` succeeds
- [ ] Net Worth comparison shows two lines
- [ ] Cumulative costs shows area fills
- [ ] Terminal distribution shows grouped bars
- [ ] SBLOC utilization shows percentile bands
- [ ] All charts responsive
- [ ] Tooltips work correctly
</verification>
