---
phase: 11-complete-results-dashboard
plan: 13
type: execute
wave: 5
depends_on: ["11-03"]
files_modified:
  - src/charts/correlation-heatmap.ts
  - src/components/ui/results-dashboard.ts
autonomous: true

must_haves:
  truths:
    - "Correlation heatmap includes Expected Annual Return column"
    - "Correlation heatmap includes Annualized Volatility column"
    - "Per-asset statistics displayed alongside correlations"
  artifacts:
    - path: "src/charts/correlation-heatmap.ts"
      provides: "Enhanced correlation heatmap"
      contains: "Expected Annual Return"
---

<objective>
Enhance correlation heatmap with per-asset return and volatility statistics.

Purpose: Show asset characteristics alongside their correlations.
Output: Extended heatmap table with return/volatility columns.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/11-complete-results-dashboard/GAPS-PLAN.md
@references/screenshots-ui/MonteCarlo-result-panel-3.png

Reference shows:
- "Simulated Assets - Correlations and Returns" header
- Correlation matrix (NxN) with color coding
- Two additional columns:
  - Expected Annual Return (green %)
  - Annualized Volatility (gray %)
- Note text explaining correlation matrix and formulas
</context>

<tasks>
- task: "Extend HeatmapData type"
  file: "src/charts/types.ts"
  action: "modify"
  details: |
    Extend HeatmapData interface:

    interface HeatmapData {
      labels: string[];
      matrix: number[][];
      // New optional fields:
      expectedReturns?: number[];  // Per-asset expected return
      volatilities?: number[];     // Per-asset annualized volatility
    }

- task: "Update correlation-heatmap component"
  file: "src/charts/correlation-heatmap.ts"
  action: "modify"
  details: |
    Enhance to display additional columns:

    Layout change:
    - Add "Expected Annual Return" column after correlation cells
    - Add "Annualized Volatility" column after that
    - Header row includes these new column headers

    Cell styling:
    - Return values in green/teal
    - Volatility values in neutral gray
    - Format as percentages

    Add note section below table:
    - "Correlation Matrix:" explanation
    - "Expected Annual Return:" formula note
    - "Annualized Volatility:" formula note
    - "Diversification Insight:" interpretation guide

- task: "Calculate asset statistics"
  file: "src/components/ui/results-dashboard.ts"
  action: "modify"
  details: |
    When setting correlation matrix data, also calculate:
    - Expected return per asset from bundled preset data
    - Annualized volatility per asset from preset data

    Pass extended HeatmapData to correlation-heatmap:
    {
      labels: [...],
      matrix: [...],
      expectedReturns: [...],
      volatilities: [...]
    }

    Note: May need to access bundled preset data for historical returns.
    Use calculateAnnualizedVolatility from calculations module.
</tasks>

<verification>
After completion:
- [ ] `npm run build` succeeds
- [ ] Heatmap shows correlation matrix
- [ ] Expected Return column displayed
- [ ] Volatility column displayed
- [ ] Values formatted as percentages
- [ ] Note text present below table
- [ ] Mobile responsive (horizontal scroll)
</verification>
