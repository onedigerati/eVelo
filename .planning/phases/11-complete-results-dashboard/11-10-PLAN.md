---
phase: 11-complete-results-dashboard
plan: 10
type: execute
wave: 3
depends_on: ["11-03"]
files_modified:
  - src/components/ui/yearly-analysis-table.ts
  - src/components/ui/results-dashboard.ts
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "Year-by-year table shows withdrawals and net worth percentiles"
    - "Columns include Annual Withdrawal, Cumulative, and P10-P90 Net Worth"
    - "Values color-coded (green positive, red negative)"
  artifacts:
    - path: "src/components/ui/yearly-analysis-table.ts"
      provides: "YearlyAnalysisTable web component"
      contains: "Year-by-Year"
---

<objective>
Add year-by-year percentile analysis table showing detailed breakdown.

Purpose: Allow users to see progression of withdrawals and net worth over time.
Output: Comprehensive table with all years and percentile data.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/11-complete-results-dashboard/GAPS-PLAN.md
@references/screenshots-ui/MonteCarlo-result-panel-7.png

Reference shows table with:
- Year column (2025-2039)
- Withdrawals: Annual and Cumulative columns
- Net Worth: 10th, 25th, 50th, 75th, 90th %ile columns
- Color coding: green for positive, red for negative values
- Scrollable for long time horizons
</context>

<tasks>
- task: "Create YearlyAnalysisTable component"
  file: "src/components/ui/yearly-analysis-table.ts"
  action: "create"
  details: |
    Web component for year-by-year breakdown:

    Props:
    - startYear: number (e.g., 2025)
    - withdrawals: { annual: number[], cumulative: number[] }
    - percentiles: YearlyPercentiles[]

    Layout:
    - Section header: "Year-by-Year Percentile Analysis"
    - Table with columns:
      - Year
      - Annual Withdrawal
      - Cumulative Withdrawal
      - 10th %ile Net Worth
      - 25th %ile Net Worth
      - 50th %ile Net Worth
      - 75th %ile Net Worth
      - 90th %ile Net Worth

    Features:
    - Sticky header row
    - Scrollable body (max-height with overflow)
    - Color coding:
      - Green: positive net worth values
      - Red: negative net worth values
      - Teal highlight for median column
    - Currency formatting for all values

    Styling:
    - Card container with shadow
    - Alternating row backgrounds
    - Responsive: horizontal scroll on mobile
    - Compact row height for many years

- task: "Calculate withdrawal data"
  file: "src/components/ui/yearly-analysis-table.ts"
  action: "create"
  details: |
    Helper to calculate cumulative withdrawals:

    function calculateWithdrawals(
      annualWithdrawal: number,
      withdrawalGrowth: number,
      timeHorizon: number
    ): { annual: number[], cumulative: number[] }

    Apply growth rate each year.
    Track running cumulative total.

- task: "Integrate into results-dashboard"
  file: "src/components/ui/results-dashboard.ts"
  action: "modify"
  details: |
    Add yearly-analysis-table section at bottom of dashboard.

    Pass data:
    - startYear from current year
    - withdrawals calculated from config
    - percentiles from simulation output

    Always show (data available from yearlyPercentiles).

- task: "Export component"
  file: "src/components/ui/index.ts"
  action: "modify"
</tasks>

<verification>
After completion:
- [ ] `npm run build` succeeds
- [ ] Table displays all years
- [ ] Withdrawals calculated correctly with growth
- [ ] Percentile values match simulation data
- [ ] Color coding works
- [ ] Scrollable on long time horizons
- [ ] Mobile horizontal scroll works
</verification>
