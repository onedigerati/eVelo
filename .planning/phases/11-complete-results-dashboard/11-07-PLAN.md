---
phase: 11-complete-results-dashboard
plan: 07
type: execute
wave: 2
depends_on: ["11-05"]
files_modified:
  - src/components/ui/strategy-analysis.ts
  - src/components/ui/results-dashboard.ts
  - src/components/ui/index.ts
  - src/calculations/sell-strategy.ts
autonomous: true

must_haves:
  truths:
    - "Strategy verdict banner shows BBD Recommended or Sell Recommended"
    - "Side-by-side comparison cards for BBD vs Sell"
    - "Wealth differential section shows BBD advantage"
  artifacts:
    - path: "src/components/ui/strategy-analysis.ts"
      provides: "StrategyAnalysis web component"
      contains: "BBD Recommended"
    - path: "src/calculations/sell-strategy.ts"
      provides: "Sell strategy calculations"
      contains: "calculateSellStrategy"
---

<objective>
Add comprehensive strategy analysis section comparing BBD vs Sell Assets strategies.

Purpose: Help users understand which strategy is better for their scenario.
Output: Verdict banner, side-by-side comparison, and wealth differential display.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/11-complete-results-dashboard/GAPS-PLAN.md
@references/screenshots-ui/MonteCarlo-result-panel-5.png
@references/screenshots-ui/MonteCarlo-result-panel-6.png

Reference shows:
- "Strategy Analysis" header with simulation details
- Verdict banner: "BBD Recommended" with success dial (81%)
- Two side-by-side cards (BBD vs Sell Assets) with metrics
- Wealth Differential row (BBD vs Sell, Tax Savings, Estate Value)
- "Why BBD Performs Well" section with insight quote
</context>

<tasks>
- task: "Create sell strategy calculations"
  file: "src/calculations/sell-strategy.ts"
  action: "create"
  details: |
    Calculate Sell Assets strategy metrics from BBD simulation data:

    interface SellStrategyResult {
      terminalNetWorth: number;  // Median
      successRate: number;       // % not depleted
      lifetimeTaxes: number;     // Cumulative capital gains taxes
      primaryRisk: string;       // "Low (X% depletion)"
    }

    function calculateSellStrategy(
      initialValue: number,
      annualWithdrawal: number,
      withdrawalGrowth: number,
      timeHorizon: number,
      yearlyPercentiles: YearlyPercentiles[],
      capitalGainsRate: number = 0.238
    ): SellStrategyResult

    Logic:
    - Simulate selling assets each year for withdrawal
    - Apply capital gains tax on gains portion
    - Track portfolio depletion
    - Compare against BBD outcomes

- task: "Create StrategyAnalysis component"
  file: "src/components/ui/strategy-analysis.ts"
  action: "create"
  details: |
    Large web component with multiple sections:

    1. Header:
       - "Strategy Analysis" title with balance icon
       - Subtitle: "Based on X Monte Carlo simulations over Y years"
       - Disclaimer badge

    2. Verdict Banner:
       - Icon container (checkmark or warning)
       - "BBD Recommended" or "Consider Sell Assets" headline
       - Rationale text
       - Success dial (circular progress showing %)

    3. Side-by-Side Comparison Grid:
       BBD Card:
       - Terminal Net Worth (median)
       - Success Rate
       - Lifetime Cost (interest paid)
       - Dividend Taxes
       - Primary Risk (margin call %)

       Sell Assets Card:
       - Terminal Net Worth (median)
       - Success Rate
       - Lifetime Cost (taxes paid)
       - Primary Risk (depletion %)

    4. Wealth Differential Row:
       Three cards showing:
       - BBD vs Sell difference (+$X)
       - Tax Savings ($X)
       - Estate Value BBD ($X)

    5. Why Strategy Performs Well:
       - Insight quote (italicized)
       - Explanation paragraph
       - Two benefit cards:
         - Tax Deferral Benefit with amount
         - Compounding Advantage with amount

    Props: bbdData, sellData, verdict, insights

- task: "Integrate into results-dashboard"
  file: "src/components/ui/results-dashboard.ts"
  action: "modify"
  details: |
    Add strategy-analysis section after spectrum visualizations.
    Calculate sell strategy data when simulation completes.
    Determine verdict based on:
    - BBD success rate vs Sell success rate
    - Terminal wealth comparison
    - Margin call risk level

    Show only when SBLOC data present (BBD strategy relevant).

- task: "Export components and calculations"
  file: "src/components/ui/index.ts"
  action: "modify"
  details: |
    Export StrategyAnalysis component

  file: "src/calculations/index.ts"
  action: "modify"
  details: |
    Export calculateSellStrategy
</tasks>

<verification>
After completion:
- [ ] `npm run build` succeeds
- [ ] Strategy verdict displays correctly
- [ ] Side-by-side comparison shows all metrics
- [ ] Wealth differential calculated correctly
- [ ] Verdict logic works (recommends based on data)
- [ ] Mobile responsive
</verification>
