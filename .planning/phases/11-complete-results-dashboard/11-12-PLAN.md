---
phase: 11-complete-results-dashboard
plan: 12
type: execute
wave: 5
depends_on: ["11-07"]
files_modified:
  - src/components/ui/recommendations-section.ts
  - src/utils/insight-generator.ts
  - src/components/ui/results-dashboard.ts
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "Recommendations section shows actionable insights"
    - "Insights generated dynamically from simulation results"
    - "Important considerations list shows risk factors"
  artifacts:
    - path: "src/components/ui/recommendations-section.ts"
      provides: "RecommendationsSection web component"
      contains: "Actionable Insights"
    - path: "src/utils/insight-generator.ts"
      provides: "Insight generation logic"
      contains: "generateInsights"
---

<objective>
Add recommendations section with actionable insights based on simulation results.

Purpose: Help users understand implications and take appropriate actions.
Output: Dynamic recommendations and risk considerations.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/11-complete-results-dashboard/GAPS-PLAN.md
@references/screenshots-ui/MonteCarlo-result-panel-2.png
@references/screenshots-ui/MonteCarlo-result-panel-7.png

Reference shows:
1. "Recommendations" with "Actionable Insights" header
   - Elevated leverage risk warning with action
   - Above-average growth assumption note
   - Return model information

2. "Important Considerations" section:
   - Margin Call Risk (19.4%) - Warning
   - Sequence of Returns Risk - Warning
   - Interest Rate Sensitivity - Note
   - Behavioral Factors - Note
   - Regulatory Risk - Note
   - Liquidity Constraints - Action
</context>

<tasks>
- task: "Create insight generator utility"
  file: "src/utils/insight-generator.ts"
  action: "create"
  details: |
    Generate insights based on simulation results:

    interface Insight {
      type: 'warning' | 'note' | 'action' | 'info';
      icon: string;  // Material icon name
      title: string;
      message: string;
      action?: string;
    }

    function generateInsights(
      statistics: SimulationStatistics,
      marginCallStats?: MarginCallStats[],
      config: SimulationConfig
    ): Insight[]

    Rules:
    - Margin call prob > 15%: Warning about elevated leverage risk
      Action: "Build $X cash buffer or reduce withdrawals by Y%"

    - CAGR > 10%: Note about above-average growth assumption
      Action: "Consider using Conservative regime mode"

    - Success rate < 80%: Warning about success probability
      Action: "Review withdrawal rate or time horizon"

    - Years above 70% LTV > 20%: Warning about utilization
      Action: "Consider lower withdrawal or higher starting value"

    - Interest rate sensitivity always shown as note
    - Behavioral factors always shown as note
    - Regulatory risk always shown as note
    - Liquidity constraints always shown with action

- task: "Create RecommendationsSection component"
  file: "src/components/ui/recommendations-section.ts"
  action: "create"
  details: |
    Web component for recommendations display:

    Props:
    - insights: Insight[]
    - considerations: Consideration[]

    Layout:
    1. "Recommendations" header
       - "Actionable Insights" subheader with count badge

    2. Insights list:
       - Each insight as a card with:
         - Colored icon (warning=orange, note=blue, action=green, info=gray)
         - Title in bold
         - Message text
         - "Action:" line if present

    3. "Important Considerations" section:
       - List of risk factors
       - Each with icon, title, and note/warning/action text

    Styling:
    - Card container
    - Icon colors match severity
    - Clear visual hierarchy
    - Expandable/collapsible option

- task: "Define standard considerations"
  file: "src/utils/insight-generator.ts"
  action: "modify"
  details: |
    Standard considerations always shown:

    1. Margin Call Risk - Dynamic value from stats
    2. Sequence of Returns Risk - Static warning
    3. Interest Rate Sensitivity - Dynamic based on rate
    4. Behavioral Factors - Static note
    5. Regulatory Risk - Static note
    6. Liquidity Constraints - Static action

- task: "Integrate into results-dashboard"
  file: "src/components/ui/results-dashboard.ts"
  action: "modify"
  details: |
    Add recommendations-section after spectrum visualizations.
    Generate insights when simulation completes.
    Pass insights and considerations as props.

- task: "Export utilities and components"
  file: "src/components/ui/index.ts"
  action: "modify"
  file: "src/utils/index.ts"
  action: "create or modify"
</tasks>

<verification>
After completion:
- [ ] `npm run build` succeeds
- [ ] Insights generated based on simulation data
- [ ] Warning shown when margin call prob high
- [ ] All 6 considerations displayed
- [ ] Icons and colors match severity
- [ ] Mobile responsive
</verification>
