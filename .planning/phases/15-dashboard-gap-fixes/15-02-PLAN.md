---
phase: 15-dashboard-gap-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/simulation/monte-carlo.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Success rate uses consistent comparison operator across codebase"
    - "Success rate counts iterations with terminal value strictly ABOVE initial value"
    - "Documentation matches implementation (above, not at-or-above)"
  artifacts:
    - path: "src/simulation/monte-carlo.ts"
      provides: "Consistent success rate calculation"
      contains: "v > initialValue"
  key_links:
    - from: "src/simulation/monte-carlo.ts"
      to: "src/calculations/metrics.ts"
      via: "Same success definition"
      pattern: "> initialValue"
---

<objective>
Fix GAP-02: Success Rate Definition Inconsistency

monte-carlo.ts uses `>=` (greater than or equal) while metrics.ts uses `>` (strictly greater) for success rate. The JSDoc says "above initial value" which implies `>`.

Purpose: Standardize on `>` operator to match documentation and metrics.ts.
Output: Consistent success rate calculation across codebase.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-dashboard-calculations-review/14-GAP-FINDINGS.md

# File with inconsistency
@src/simulation/monte-carlo.ts

# Reference with correct operator
@src/calculations/metrics.ts (line 188 shows `>` operator)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix success rate operator in calculateStatistics</name>
  <files>src/simulation/monte-carlo.ts</files>
  <action>
    Update line 331 in calculateStatistics function:

    Change from:
    ```typescript
    const successCount = values.filter(v => v >= initialValue).length;
    ```

    To:
    ```typescript
    const successCount = values.filter(v => v > initialValue).length;
    ```

    This aligns with:
    - metrics.ts line 188: `if (terminalValues[i] > initialValue)`
    - JSDoc documentation: "Success is defined as ending above the initial portfolio value"
    - The word "above" (not "at or above")
  </action>
  <verify>
    Grep for ">= initialValue" in monte-carlo.ts should return no matches
    Grep for "> initialValue" should show the corrected line
  </verify>
  <done>Success rate calculation uses `>` operator matching metrics.ts and documentation</done>
</task>

<task type="auto">
  <name>Task 2: Verify consistency and build</name>
  <files>src/simulation/monte-carlo.ts, src/calculations/metrics.ts</files>
  <action>
    1. Verify both files now use the same operator:
       - monte-carlo.ts: `v > initialValue`
       - metrics.ts: `terminalValues[i] > initialValue`

    2. Run TypeScript compilation:
       `npm run build`

    3. Document the standardized definition:
       "Success = terminal value strictly greater than initial value"
  </action>
  <verify>
    - `npm run build` completes without errors
    - Both monte-carlo.ts and metrics.ts use `> initialValue` (not `>=`)
  </verify>
  <done>Success rate definition is consistent across codebase with `>` operator</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. monte-carlo.ts line 331 uses `>` not `>=`
2. Pattern matches metrics.ts line 188
3. Build completes without errors
</verification>

<success_criteria>
GAP-02 FIXED: Success rate uses consistent `>` operator:
- monte-carlo.ts calculateStatistics: `v > initialValue`
- metrics.ts calculateSuccessRate: `terminalValues[i] > initialValue`
- Both match documentation: "ending above the initial portfolio value"
</success_criteria>

<output>
After completion, create `.planning/phases/15-dashboard-gap-fixes/15-02-SUMMARY.md`
</output>
