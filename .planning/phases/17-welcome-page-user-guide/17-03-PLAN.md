---
phase: 17-welcome-page-user-guide
plan: 03
type: execute
wave: 2
depends_on:
  - 17-01
  - 17-02
files_modified:
  - src/components/app-root.ts
autonomous: true

must_haves:
  truths:
    - "Welcome screen displays on app load when no simulation has been run"
    - "Welcome screen hides after simulation completes"
    - "User guide button in header opens user guide modal"
    - "Quick-start button on welcome screen triggers simulation"
    - "Learn More button on welcome screen opens user guide"
    - "Navigation between welcome, guide, and dashboard is intuitive"
  artifacts:
    - path: "src/components/app-root.ts"
      provides: "Integration of welcome-screen and user-guide-modal"
      contains: ["welcome-screen", "user-guide-modal"]
  key_links:
    - from: "src/components/app-root.ts"
      to: "welcome-screen"
      via: "template includes welcome-screen element"
      pattern: "<welcome-screen"
    - from: "src/components/app-root.ts"
      to: "user-guide-modal"
      via: "template includes user-guide-modal element"
      pattern: "<user-guide-modal"
    - from: "src/components/app-root.ts"
      to: "simulation-complete event"
      via: "hides welcome screen on simulation"
      pattern: "simulation-complete.*welcome"
    - from: "src/components/app-root.ts"
      to: "user-guide-modal.show()"
      via: "btn-guide click handler"
      pattern: "btn-guide.*addEventListener.*userGuide.*show"
---

<objective>
Integrate the welcome screen and user guide modal into the app-root component, wiring up state management and event handlers.

Purpose: Connect the new components to the application, ensuring the welcome screen shows appropriately (before first simulation) and the user guide is accessible from the header.

Output: Updated app-root.ts with welcome screen and user guide integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-welcome-page-user-guide/17-01-SUMMARY.md
@.planning/phases/17-welcome-page-user-guide/17-02-SUMMARY.md

# Current app-root implementation
@src/components/app-root.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add welcome-screen and user-guide to template</name>
  <files>src/components/app-root.ts</files>
  <action>
Modify the `template()` method in app-root.ts to include the new components.

**1. Add User Guide button to header (next to Settings button):**
In the header-content div, add a button before the settings button:
```html
<button id="btn-guide" class="header-btn" aria-label="User Guide" title="User Guide">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"></circle>
    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
    <line x1="12" y1="17" x2="12.01" y2="17"></line>
  </svg>
</button>
```
Note: The click handler for this button will be wired in Task 3. This task only adds the button to the template.

**2. Add welcome-screen inside dashboard div:**
At the start of the dashboard div (before the existing help-section and comparison-dashboard), add:
```html
<welcome-screen id="welcome"></welcome-screen>
```

**3. Add user-guide-modal at root level:**
After toast-container and settings-panel, add:
```html
<user-guide-modal id="user-guide"></user-guide-modal>
```

**4. Update the existing inline "What is Buy-Borrow-Die?" help-section (CONDITIONAL):**
The existing help-section in the dashboard (around line 404-412) should remain but only be visible when the welcome screen is hidden. Add a CSS class to control visibility:
- Add `class="bbd-inline-help"` to the existing `<help-section title="What is Buy-Borrow-Die?">` element
- If the help-section doesn't exist, skip this step (it may have been removed in a prior refactor)
  </action>
  <verify>
Template includes:
- `<button id="btn-guide"` in header (element exists, wiring in Task 3)
- `<welcome-screen id="welcome">` in dashboard
- `<user-guide-modal id="user-guide">` at root level
  </verify>
  <done>
Template contains all new components properly positioned.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add styles for welcome/guide integration</name>
  <files>src/components/app-root.ts</files>
  <action>
Add styles to the `styles()` method for the new components.

Add CSS rules:

```css
/* Welcome screen takes up dashboard space when visible */
welcome-screen {
  display: block;
}

welcome-screen.hidden {
  display: none;
}

/* Hide inline BBD help when welcome is visible */
.bbd-inline-help {
  display: none;
}

/* Show inline help only when welcome is hidden */
welcome-screen.hidden ~ .bbd-inline-help {
  display: block;
}

/* Header buttons spacing */
.header-content {
  gap: var(--spacing-sm, 8px);
}

#btn-guide {
  /* Same styling as #btn-settings, already defined */
}
```

Note: The header-btn styles already exist and apply to both buttons.
  </action>
  <verify>
styles() includes welcome-screen display rules and .bbd-inline-help visibility toggle.
  </verify>
  <done>
CSS properly shows/hides welcome screen and inline help section.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire up event handlers in afterRender</name>
  <files>src/components/app-root.ts</files>
  <action>
Add event handlers in `afterRender()` method.

**1. User guide button handler:**
After the existing settings button handler, add:
```typescript
// User guide button handler
const guideBtn = this.$('#btn-guide');
const userGuide = this.$('#user-guide') as any;

guideBtn?.addEventListener('click', () => {
  userGuide?.show();
});
```

**2. Welcome screen management:**
Add after the toast container setup:
```typescript
// Welcome screen management
const welcome = this.$('#welcome') as any;
const bbdInlineHelp = this.$('.bbd-inline-help');

// Show welcome if no simulation has been run
// Hide if simulation exists or user has already seen welcome this session
const hasSimulationResults = this._simulationResult !== null;
if (hasSimulationResults) {
  welcome?.classList.add('hidden');
} else {
  welcome?.classList.remove('hidden');
}
```

**3. Handle welcome screen events:**
```typescript
// Quick-start: trigger simulation with current/default parameters
this.addEventListener('quick-start', () => {
  welcome?.classList.add('hidden');
  // Trigger simulation
  runBtn?.click();
});

// Show guide: open user guide modal
this.addEventListener('show-guide', () => {
  userGuide?.show();
});
```

**4. Update simulation-complete handler:**
In the existing simulation-complete dispatch section (after the successful simulation), ensure welcome screen is hidden:
```typescript
// After simulation success, hide welcome
welcome?.classList.add('hidden');
```

This should be placed inside the try block after `this._simulationResult = result;`
  </action>
  <verify>
afterRender() includes:
- guideBtn click handler opening user guide (wiring for button from Task 1)
- welcome screen visibility based on _simulationResult
- quick-start event listener triggering simulation
- show-guide event listener opening user guide
- welcome hidden after simulation completes
  </verify>
  <done>
All event wiring in place for seamless welcome -> simulation -> results flow.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build` completes without TypeScript errors
2. Dev server test: `npm run dev` and verify:
   - Welcome screen visible on initial load
   - User guide button visible in header
   - "Run Your First Simulation" triggers simulation
   - "View User Guide" opens modal
   - After simulation, welcome screen is hidden
   - User guide button still works after simulation
3. Navigation flow is intuitive
</verification>

<success_criteria>
- Welcome screen displays on app load (before any simulation)
- Welcome screen hides after successful simulation
- User guide accessible via header button at all times
- Quick-start and Learn More buttons work correctly
- Inline BBD help section visible only when welcome is hidden (if it exists)
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-welcome-page-user-guide/17-03-SUMMARY.md`
</output>
