---
phase: 17-welcome-page-user-guide
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/user-guide-modal.ts
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "User guide modal opens when triggered"
    - "User guide modal closes on Escape key"
    - "User guide modal closes on overlay click"
    - "User guide has expandable sections using help-section components"
    - "All simulation parameters are documented with clear descriptions"
    - "Chart interpretations are explained"
    - "Glossary defines key financial terms (SBLOC, LTV, step-up basis)"
  artifacts:
    - path: "src/components/ui/user-guide-modal.ts"
      provides: "UserGuideModal component with comprehensive documentation"
      min_lines: 300
      exports: ["UserGuideModal"]
    - path: "src/components/ui/index.ts"
      provides: "Barrel export including user-guide-modal"
      contains: "user-guide-modal"
  key_links:
    - from: "src/components/ui/user-guide-modal.ts"
      to: "help-section"
      via: "nested accordions for progressive disclosure"
      pattern: "<help-section"
    - from: "src/components/ui/user-guide-modal.ts"
      to: "customElements"
      via: "element registration"
      pattern: "customElements\\.define\\('user-guide-modal'"
---

<objective>
Create the comprehensive user guide modal component that documents all simulation parameters, chart interpretations, and financial terminology.

Purpose: Provide users with in-context help that explains how to use the simulator, what each parameter means, and how to interpret results - accessible via a modal that doesn't interrupt workflow.

Output: `UserGuideModal` Web Component using `help-section` accordions for progressive disclosure.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-welcome-page-user-guide/17-RESEARCH.md

# Existing components to use
@src/components/base-component.ts
@src/components/ui/help-section.ts
@src/components/ui/modal-dialog.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create user-guide-modal component with core structure and first 4 sections</name>
  <files>src/components/ui/user-guide-modal.ts</files>
  <action>
Create `UserGuideModal` Web Component that extends `BaseComponent`.

**Template structure:**
1. Overlay container (fixed position, blur backdrop, centered modal)
2. Modal card with header (title + close button)
3. Scrollable body with help-section accordions (first 4 sections in this task)
4. Footer with disclaimer

**Help sections to include in this task:**

1. **Getting Started** (open by default):
   - Brief intro to eVelo and BBD strategy
   - Quick start steps: 1) Set initial investment, 2) Choose asset allocation, 3) Configure SBLOC terms, 4) Click Run Simulation

2. **Portfolio Parameters**:
   - Initial Investment: Starting portfolio value ($1M-$100M typical)
   - Asset Allocation: Distribution across asset classes
   - Initial LOC Balance: Pre-existing loan balance

3. **Spending Parameters**:
   - Annual Cash Need: Tax-free income from borrowing
   - Annual Increase: Inflation adjustment (2-4% typical)
   - Withdraw Monthly: More realistic monthly compounding

4. **SBLOC Terms**:
   - Annual Interest Rate: SOFR + 1-3% (~5-7%)
   - Max LTV / Hard Margin: Portfolio liquidated if exceeded
   - Warning Zone LTV: Margin call threshold
   - Liquidation Haircut: Transaction costs on forced sale

**Styling requirements:**
- Fixed overlay with backdrop blur (4px)
- Modal max-width 800px, max-height 90vh
- Mobile: Full screen (100% width, 100% height, no border-radius)
- Scrollable body with flex-grow
- Close button (X) in header corner
- Footer with disclaimer (italic, secondary color)

**Event handling:**
- Close button click: call hide()
- Overlay click (outside modal): call hide()
- Escape key: call hide()
- Clean up document keydown listener in disconnectedCallback

**Public methods:**
- `show()`: Add 'open' class to overlay
- `hide()`: Remove 'open' class from overlay

Use definition lists (`<dl><dt><dd>`) for parameter documentation to ensure consistent formatting.
  </action>
  <verify>
File exists at src/components/ui/user-guide-modal.ts with:
- Class extends BaseComponent
- template() returns overlay with modal, 4 help-sections, footer
- styles() includes overlay positioning, blur, mobile full-screen
- show()/hide() methods toggle 'open' class
- afterRender() sets up close handlers (button, overlay click, escape)
- disconnectedCallback() removes document keydown listener
  </verify>
  <done>
UserGuideModal component created with core structure, styling, event handling, and first 4 help sections.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add remaining 4 help sections to user-guide-modal</name>
  <files>src/components/ui/user-guide-modal.ts</files>
  <action>
Add the remaining 4 help-sections to the template() method, after the SBLOC Terms section.

**Help sections to add:**

5. **Simulation Settings**:
   - Iterations: 10,000 typically sufficient
   - Return Distribution Model: Bootstrap vs Regime-Switching
   - Expected Inflation: For real return calculations

6. **Understanding Charts**:
   - Probability Cone: Range of portfolio values, percentile bands
   - Terminal Value Distribution: Final outcomes histogram
   - Margin Call Risk: Probability by year
   - SBLOC Balance Over Time: Loan growth trajectory

7. **Key Metrics Explained**:
   - Success Rate: Percentage ending with positive net worth
   - Median Final Value: 50th percentile outcome
   - CAGR: Compound Annual Growth Rate
   - Max Drawdown: Worst peak-to-trough decline
   - Salary Equivalent: Pre-tax salary to match SBLOC withdrawals

8. **Glossary**:
   - Buy-Borrow-Die (BBD)
   - SBLOC (Securities-Backed Line of Credit)
   - LTV (Loan-to-Value)
   - Margin Call
   - Stepped-Up Basis
   - Monte Carlo Simulation

Continue using definition lists (`<dl><dt><dd>`) for consistent formatting.
Also add customElements.define('user-guide-modal', UserGuideModal) at the end of the file.
  </action>
  <verify>
File includes:
- All 8 help-sections in template()
- customElements.define('user-guide-modal', UserGuideModal) at bottom
- Glossary section has all 6 key terms defined
  </verify>
  <done>
UserGuideModal component complete with all 8 documentation sections and element registration.
  </done>
</task>

<task type="auto">
  <name>Task 3: Export user-guide-modal from barrel</name>
  <files>src/components/ui/index.ts</files>
  <action>
Add import for the new user-guide-modal component to the UI barrel export file.

Add line: `import './user-guide-modal';`

Place it alphabetically with other imports.
  </action>
  <verify>
`grep "user-guide-modal" src/components/ui/index.ts` shows the import line.
  </verify>
  <done>
UserGuideModal component is auto-registered when UI components are imported.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build` completes without TypeScript errors
2. Component registered: user-guide-modal custom element is defined
3. Nested components work: help-section elements render inside modal
4. All parameter sections documented: 8 help-sections present
5. Accessibility: Modal has role="dialog", aria-modal="true", aria-labelledby
</verification>

<success_criteria>
- UserGuideModal component exists and exports correctly
- Template includes all 8 help-section accordions with parameter documentation
- Modal is accessible (ARIA attributes, keyboard navigation)
- Styling is responsive (full-screen on mobile)
- Show/hide methods work correctly
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-welcome-page-user-guide/17-02-SUMMARY.md`
</output>
