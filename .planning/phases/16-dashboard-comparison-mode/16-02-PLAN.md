---
phase: 16-dashboard-comparison-mode
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/components/ui/comparison-dashboard.ts
  - src/components/ui/delta-indicator.ts
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "Comparison dashboard shows two results-dashboard instances side-by-side on desktop"
    - "Delta indicators display +/- with correct colors (green for positive, red for negative)"
    - "Comparison dashboard can enter and exit comparison mode"
    - "Exit Comparison button is visible and functional"
  artifacts:
    - path: "src/components/ui/comparison-dashboard.ts"
      provides: "Container for side-by-side comparison view"
      exports: ["ComparisonDashboard"]
      min_lines: 150
    - path: "src/components/ui/delta-indicator.ts"
      provides: "Reusable delta display component"
      exports: ["DeltaIndicator"]
      min_lines: 80
  key_links:
    - from: "src/components/ui/comparison-dashboard.ts"
      to: "results-dashboard"
      via: "contains two results-dashboard elements"
      pattern: "<results-dashboard"
    - from: "src/components/ui/comparison-dashboard.ts"
      to: "comparison-state.ts"
      via: "imports comparisonState"
      pattern: "import.*comparisonState"
    - from: "src/components/ui/delta-indicator.ts"
      to: "delta-calculations.ts"
      via: "imports calculateDelta"
      pattern: "import.*calculateDelta"
---

<objective>
Create the desktop comparison view components: comparison-dashboard wrapper and delta-indicator.

Purpose: Enable side-by-side comparison of simulation results on desktop viewports (>768px). The comparison-dashboard wraps two results-dashboard instances with panel headers and an exit button. Delta indicators provide visual feedback on metric changes.

Output: Two new Web Components registered and exported.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-dashboard-comparison-mode/16-RESEARCH.md

# Dependencies from Wave 1
@src/services/comparison-state.ts — ComparisonStateManager (from 16-01)
@src/utils/delta-calculations.ts — Delta calculation utilities (from 16-01)

# Existing components to wrap/extend
@src/components/ui/results-dashboard.ts — Existing dashboard to embed (first 100 lines for pattern reference)
@src/components/base-component.ts — Base class for Web Components
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DeltaIndicator component</name>
  <files>src/components/ui/delta-indicator.ts</files>
  <action>
Create a reusable component for displaying metric deltas:

1. Import BaseComponent, calculateDelta from appropriate modules

2. Define observed attributes:
   - value: current numeric value
   - previous-value: previous numeric value
   - format: 'currency' | 'percent' | 'number' (default: 'number')
   - label: optional label text

3. Template structure:
```html
<div class="delta-indicator {positive|negative|neutral}">
  <span class="delta-label">{label}</span>
  <div class="delta-values">
    <span class="delta-change">{+/-}{formatted delta}</span>
    <span class="delta-percent">({+/-}{percentChange}%)</span>
  </div>
  <div class="delta-arrow">{up/down/neutral arrow}</div>
</div>
```

4. Styles:
   - .positive: green background (rgba(34, 197, 94, 0.1)), green text (#22c55e)
   - .negative: red background (rgba(239, 68, 68, 0.1)), red text (#ef4444)
   - .neutral: gray background, gray text
   - Flexbox layout with gap between elements
   - Font weight 600 for delta-change

5. Format helpers:
   - formatValue(value, format): Format as currency ($X,XXX), percent (X.X%), or number
   - Use Intl.NumberFormat for currency

6. Register: customElements.define('delta-indicator', DeltaIndicator)
  </action>
  <verify>
```html
<delta-indicator value="1200000" previous-value="1000000" format="currency" label="Final Value"></delta-indicator>
<!-- Should show: Final Value | +$200,000 (+20.0%) | arrow up | green -->
```
  </verify>
  <done>DeltaIndicator component renders with correct colors and formatting based on delta direction</done>
</task>

<task type="auto">
  <name>Task 2: Create ComparisonDashboard component</name>
  <files>src/components/ui/comparison-dashboard.ts, src/components/ui/index.ts</files>
  <action>
Create the main comparison container component:

1. Import BaseComponent, comparisonState, computeComparisonMetrics, ResultsDashboard type

2. Private state:
   - _isComparisonMode: boolean = false
   - _previousData: SimulationOutput | null = null
   - _currentData: SimulationOutput | null = null
   - _previousConfig: SimulationConfig | null = null
   - _currentConfig: SimulationConfig | null = null
   - _previousPresetName: string = ''
   - _currentPresetName: string = ''

3. Template for desktop (comparison mode):
```html
<div class="comparison-container">
  <div class="comparison-header">
    <h2>Comparing Strategies</h2>
    <button class="exit-btn">Exit Comparison</button>
  </div>
  <div class="comparison-grid">
    <div class="comparison-panel previous-panel">
      <div class="panel-header">
        <span class="panel-label">Previous</span>
        <span class="panel-name">{previousPresetName}</span>
      </div>
      <results-dashboard id="previous-dashboard"></results-dashboard>
    </div>
    <div class="comparison-panel current-panel">
      <div class="panel-header">
        <span class="panel-label">Current</span>
        <span class="panel-name">{currentPresetName}</span>
      </div>
      <results-dashboard id="current-dashboard"></results-dashboard>
    </div>
  </div>
  <div class="delta-summary">
    <!-- Delta indicators for key metrics -->
  </div>
</div>
```

4. Template for single mode (not comparing):
```html
<results-dashboard id="single-dashboard"></results-dashboard>
```

5. Styles:
   - .comparison-grid: CSS Grid with `grid-template-columns: 1fr 1fr; gap: 24px;`
   - .panel-header: Flexbox, border-bottom 2px solid teal, margin-bottom 16px
   - .previous-panel: Left border 3px solid #8b5cf6 (purple)
   - .current-panel: Left border 3px solid #0d9488 (teal)
   - .exit-btn: Positioned top-right, outlined button style
   - Hide .comparison-container on mobile (max-width: 768px) - mobile handled in 16-03

6. Public methods:
   - enterComparisonMode(previous, current, prevConfig, currConfig, prevName, currName): Set state, render, update child dashboards
   - exitComparisonMode(): Reset to single mode, dispatch 'exit-comparison-mode' event
   - set data(value: SimulationOutput): For single mode, pass to single-dashboard

7. afterRender():
   - Wire exit button click to exitComparisonMode()
   - Pass data to child results-dashboard instances via their data setters
   - Listen for comparison-state-change events to sync state

8. Register and export from ui/index.ts

NOTE: Do NOT duplicate results-dashboard code. Use the existing component via composition.
  </action>
  <verify>
1. Component renders in single mode by default
2. Calling enterComparisonMode() shows two-panel grid
3. Exit button returns to single mode
4. Child dashboards receive data correctly
  </verify>
  <done>ComparisonDashboard component shows side-by-side results with panel headers and exit functionality</done>
</task>

</tasks>

<verification>
1. Both components registered: document.createElement('delta-indicator'), document.createElement('comparison-dashboard')
2. DeltaIndicator shows correct colors for positive/negative/neutral
3. ComparisonDashboard grid layout works at >768px viewport
4. Exit button dispatches event and returns to single mode
5. TypeScript compiles without errors: `npx tsc --noEmit`
6. Components exported from src/components/ui/index.ts
</verification>

<success_criteria>
- DeltaIndicator renders with appropriate styling based on delta direction
- ComparisonDashboard displays two results-dashboard panels side-by-side on desktop
- Panel headers show preset names with colored left borders
- Exit Comparison button works and dispatches event
- Components follow existing BaseComponent patterns
</success_criteria>

<output>
After completion, create `.planning/phases/16-dashboard-comparison-mode/16-02-SUMMARY.md`
</output>
