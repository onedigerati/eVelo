---
phase: 16-dashboard-comparison-mode
plan: 03
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/components/ui/comparison-dashboard.ts
  - src/components/ui/trade-off-summary.ts
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "Mobile view shows Previous/Current/Delta tabs instead of side-by-side panels"
    - "Tab navigation works with keyboard (arrow keys)"
    - "Trade-off summary provides plain-language assessment"
    - "Screen readers can navigate comparison tabs"
  artifacts:
    - path: "src/components/ui/trade-off-summary.ts"
      provides: "Plain-language trade-off assessment component"
      exports: ["TradeOffSummary"]
      min_lines: 100
  key_links:
    - from: "src/components/ui/comparison-dashboard.ts"
      to: "ARIA tab pattern"
      via: "role=tablist, aria-selected"
      pattern: "role=\"tablist\""
    - from: "src/components/ui/trade-off-summary.ts"
      to: "ComparisonMetrics"
      via: "imports from delta-calculations"
      pattern: "import.*ComparisonMetrics"
---

<objective>
Add mobile responsive tabs to comparison-dashboard and create trade-off summary component.

Purpose: Provide accessible comparison experience on mobile devices using ARIA-compliant tabbed interface (Previous/Current/Delta). Trade-off summary generates plain-language assessment of strategy differences for quick decision-making.

Output: Updated comparison-dashboard with mobile tabs, new trade-off-summary component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-dashboard-comparison-mode/16-RESEARCH.md

# Dependencies
@src/services/comparison-state.ts — ComparisonStateManager (from 16-01)
@src/utils/delta-calculations.ts — Delta utilities (from 16-01)
@src/components/ui/comparison-dashboard.ts — Will be modified (from 16-02)

# Reference for existing patterns
@src/utils/insight-generator.ts — Pattern for generating text insights
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TradeOffSummary component</name>
  <files>src/components/ui/trade-off-summary.ts</files>
  <action>
Create component that generates plain-language trade-off assessment:

1. Import BaseComponent, ComparisonMetrics from appropriate modules

2. Define TradeOffSummaryData interface:
   - headline: string (main takeaway)
   - assessment: 'previous-better' | 'current-better' | 'similar'
   - keyDifferences: string[] (up to 4 bullet points)
   - recommendation: string

3. Define observed attributes or property setters:
   - metrics: ComparisonMetrics
   - previousName: string
   - currentName: string

4. Create generateSummary() method that produces TradeOffSummaryData:
   - Score each metric: +2 for finalValue advantage, +1 for successRate, +1 for lower marginCallProbability
   - Compare scores to determine assessment
   - Generate difference sentences like:
     - "{currentName} produces ${formatCurrency(delta)} higher median terminal value"
     - "{previousName} has {X}% higher success rate"
     - "{currentName} has {X}% lower margin call risk"
   - Limit to top 4 differences
   - Generate headline based on assessment
   - Generate recommendation based on assessment

5. Template:
```html
<div class="trade-off-summary">
  <div class="summary-headline {assessment}">{headline}</div>
  <ul class="key-differences">
    {keyDifferences.map(d => `<li>${d}</li>`)}
  </ul>
  <p class="recommendation">{recommendation}</p>
</div>
```

6. Styles:
   - .summary-headline: Large font (1.25rem), bold, colored by assessment
   - .previous-better: Purple text (#8b5cf6)
   - .current-better: Teal text (#0d9488)
   - .similar: Gray text
   - .key-differences: Bulleted list with spacing
   - .recommendation: Italic, secondary text color

7. Register: customElements.define('trade-off-summary', TradeOffSummary)

Follow insight-generator.ts pattern for generating human-readable text.
  </action>
  <verify>
```javascript
const summary = document.createElement('trade-off-summary');
summary.metrics = { finalValue: { absolute: 50000, percentChange: 5, direction: 'up' }, ... };
summary.previousName = 'Conservative';
summary.currentName = 'Aggressive';
// Should show assessment headline and bullet points
```
  </verify>
  <done>TradeOffSummary component generates and displays plain-language assessment</done>
</task>

<task type="auto">
  <name>Task 2: Add mobile tabs to ComparisonDashboard</name>
  <files>src/components/ui/comparison-dashboard.ts, src/components/ui/index.ts</files>
  <action>
Extend comparison-dashboard.ts to include mobile tabbed interface:

1. Add to template (inside comparison-container, shown only on mobile):
```html
<div class="comparison-tabs" role="tablist" aria-label="Comparison view">
  <button role="tab" id="tab-previous" aria-selected="true" aria-controls="panel-previous" tabindex="0">
    Previous
    <span class="tab-badge">{previousPresetName}</span>
  </button>
  <button role="tab" id="tab-current" aria-selected="false" aria-controls="panel-current" tabindex="-1">
    Current
    <span class="tab-badge">{currentPresetName}</span>
  </button>
  <button role="tab" id="tab-delta" aria-selected="false" aria-controls="panel-delta" tabindex="-1">
    Delta
  </button>
</div>

<div id="panel-previous" role="tabpanel" aria-labelledby="tab-previous" class="tab-panel">
  <results-dashboard id="mobile-previous-dashboard"></results-dashboard>
</div>
<div id="panel-current" role="tabpanel" aria-labelledby="tab-current" class="tab-panel" hidden>
  <results-dashboard id="mobile-current-dashboard"></results-dashboard>
</div>
<div id="panel-delta" role="tabpanel" aria-labelledby="tab-delta" class="tab-panel" hidden>
  <div class="delta-table">
    <!-- Delta metrics table -->
  </div>
  <trade-off-summary></trade-off-summary>
</div>
```

2. Add styles for mobile tabs:
```css
.comparison-tabs {
  display: none; /* Hidden on desktop */
}

@media (max-width: 768px) {
  .comparison-grid {
    display: none; /* Hide desktop grid */
  }
  .comparison-tabs {
    display: flex;
    border-bottom: 2px solid var(--border-color);
  }
  .comparison-tabs button {
    flex: 1;
    padding: 12px;
    background: transparent;
    border: none;
    cursor: pointer;
  }
  .comparison-tabs button[aria-selected="true"] {
    border-bottom: 2px solid var(--color-primary);
    color: var(--color-primary);
    font-weight: 600;
  }
  .tab-panel[hidden] {
    display: none;
  }
}
```

3. Add keyboard navigation in afterRender():
   - Get all tab buttons
   - On ArrowRight: activate next tab
   - On ArrowLeft: activate previous tab
   - activateTab(tab): Update aria-selected, tabindex, show/hide panels

4. Create delta table in Delta panel:
   - List key metrics with delta-indicator for each
   - Metrics: Final Value, Success Rate, CAGR, Margin Call Risk (if SBLOC)
   - Use computeComparisonMetrics() to get values

5. Update trade-off-summary in Delta panel when metrics change

6. Export TradeOffSummary from ui/index.ts
  </action>
  <verify>
1. Resize browser to <768px width
2. Verify tabs appear and desktop grid hides
3. Click tabs to switch between Previous/Current/Delta views
4. Use keyboard arrow keys to navigate tabs
5. Screen reader announces tab changes correctly
  </verify>
  <done>Mobile tabs work with ARIA compliance and keyboard navigation</done>
</task>

</tasks>

<verification>
1. Trade-off summary generates appropriate text based on metrics
2. Mobile tabs appear at <=768px viewport
3. Desktop grid appears at >768px viewport
4. Tab keyboard navigation works (ArrowLeft/ArrowRight)
5. ARIA attributes correct: role=tablist, aria-selected, aria-controls, tabindex
6. Delta panel shows metrics table and trade-off summary
7. TypeScript compiles without errors: `npx tsc --noEmit`
</verification>

<success_criteria>
- TradeOffSummary displays headline, differences, and recommendation
- Mobile view shows tabs instead of side-by-side panels
- Keyboard navigation between tabs works
- Screen readers can navigate comparison (ARIA compliant)
- Delta tab shows metric comparisons and trade-off summary
</success_criteria>

<output>
After completion, create `.planning/phases/16-dashboard-comparison-mode/16-03-SUMMARY.md`
</output>
