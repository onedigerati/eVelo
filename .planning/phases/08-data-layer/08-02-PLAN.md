---
phase: 08-data-layer
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/data/presets/sp500.json
  - src/data/presets/indices.json
  - src/data/services/preset-service.ts
  - src/data/services/index.ts
autonomous: true

must_haves:
  truths:
    - "S&P 500 historical returns load without network request"
    - "Bundled data spans at least 30 years of daily returns"
    - "Data imports inline at build time via Vite JSON imports"
  artifacts:
    - path: "src/data/presets/sp500.json"
      provides: "30+ years of S&P 500 daily returns"
      min_lines: 100
    - path: "src/data/services/preset-service.ts"
      provides: "Functions to access bundled preset data"
      exports: ["getPresetSymbols", "getPresetData", "BUNDLED_PRESETS"]
  key_links:
    - from: "src/data/services/preset-service.ts"
      to: "src/data/presets/*.json"
      via: "static import for Vite inlining"
      pattern: "import.*from.*presets/"
---

<objective>
Bundle historical S&P 500 data as static JSON imports that Vite inlines at build time.

Purpose: Enable offline simulation without requiring API calls. Users can run simulations immediately.
Output: JSON preset files and preset-service for accessing bundled data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-data-layer/08-RESEARCH.md
@.planning/phases/08-data-layer/08-01-PLAN.md

@src/data/schemas/market-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bundled S&P 500 preset data</name>
  <files>src/data/presets/sp500.json</files>
  <action>
    Create src/data/presets/ directory.

    Create sp500.json with historical S&P 500 daily returns.

    Structure:
    ```json
    {
      "symbol": "SPY",
      "name": "S&P 500 ETF (SPY)",
      "startDate": "1993-01-29",
      "endDate": "2024-12-31",
      "returns": [
        { "date": "1993-01-29", "return": 0.0043 },
        ...
      ]
    }
    ```

    For this plan, create representative data:
    - Start with ~100 sample data points showing realistic market behavior
    - Include a mix of positive, negative, and extreme returns
    - Daily returns typically range from -0.10 to +0.10, with most in -0.02 to +0.02
    - Include a few "crash" days (e.g., -0.07 to -0.12) and "rally" days (+0.04 to +0.08)

    Note: Full historical data (~7,500 points for 30 years) would be added later or fetched from API. For now, create enough sample data to demonstrate the pattern and enable basic testing.
  </action>
  <verify>JSON parses correctly, has required fields</verify>
  <done>S&P 500 preset JSON created with sample data structure</done>
</task>

<task type="auto">
  <name>Task 2: Create indices preset data</name>
  <files>src/data/presets/indices.json</files>
  <action>
    Create indices.json with a collection of major market indices.

    Structure:
    ```json
    {
      "QQQ": {
        "symbol": "QQQ",
        "name": "Nasdaq-100 ETF",
        "startDate": "1999-03-10",
        "endDate": "2024-12-31",
        "returns": [...]
      },
      "IWM": {
        "symbol": "IWM",
        "name": "Russell 2000 ETF",
        "startDate": "2000-05-26",
        "endDate": "2024-12-31",
        "returns": [...]
      },
      "AGG": {
        "symbol": "AGG",
        "name": "US Aggregate Bond ETF",
        "startDate": "2003-09-29",
        "endDate": "2024-12-31",
        "returns": [...]
      }
    }
    ```

    Include ~50 sample data points for each index with realistic characteristics:
    - QQQ: Higher volatility than SPY (tech-heavy)
    - IWM: Higher volatility (small caps)
    - AGG: Low volatility bonds (returns typically -0.01 to +0.01)
  </action>
  <verify>JSON parses correctly, contains all indices</verify>
  <done>Indices preset JSON created with sample data</done>
</task>

<task type="auto">
  <name>Task 3: Create preset service</name>
  <files>src/data/services/preset-service.ts, src/data/services/index.ts</files>
  <action>
    Create src/data/services/ directory.

    **preset-service.ts:**
    Import JSON files directly (Vite inlines at build):
    ```typescript
    import sp500Data from '../presets/sp500.json';
    import indicesData from '../presets/indices.json';
    ```

    Define PresetData interface:
    - symbol: string
    - name: string
    - startDate: string
    - endDate: string
    - returns: { date: string; return: number }[]

    Export BUNDLED_PRESETS record combining sp500 and all indices.

    Export functions:
    - getPresetSymbols(): string[] - returns all available symbols
    - getPresetData(symbol: string): PresetData | undefined
    - isPresetSymbol(symbol: string): boolean

    **services/index.ts:**
    Barrel export from preset-service.

    Update src/data/index.ts to also export from './services'.
  </action>
  <verify>npm run build succeeds, exports work correctly</verify>
  <done>Preset service exports bundled data access functions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] JSON files parse without error
- [ ] preset-service exports BUNDLED_PRESETS, getPresetSymbols, getPresetData
- [ ] Vite inlines JSON at build (verify in dist/ bundle)
</verification>

<success_criteria>
- S&P 500 and indices JSON files created
- Preset service provides typed access to bundled data
- Data loads synchronously without network requests
</success_criteria>

<output>
After completion, create `.planning/phases/08-data-layer/08-02-SUMMARY.md`
</output>
