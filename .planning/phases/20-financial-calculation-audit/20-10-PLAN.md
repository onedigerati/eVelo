---
phase: 20-financial-calculation-audit
plan: 10
type: execute
wave: 3
depends_on: ["20-01", "20-03", "20-04"]
files_modified:
  - src/components/ui/param-section.ts
  - src/components/ui/results-dashboard.ts
autonomous: true

must_haves:
  truths:
    - "User can configure cost basis ratio via UI"
    - "User can configure dividend yield via UI"
    - "Configuration passed to Sell strategy calculation"
  artifacts:
    - path: "src/components/ui/param-section.ts"
      provides: "UI inputs for Sell strategy config"
    - path: "src/components/ui/results-dashboard.ts"
      provides: "Wiring of UI config to calculation"
  key_links:
    - from: "src/components/ui/param-section.ts"
      to: "src/components/ui/results-dashboard.ts"
      via: "config event"
      pattern: "costBasisRatio|dividendYield"
---

<objective>
Add UI controls for cost basis and dividend yield

Purpose: Complete Risk Areas #1 and #2 by exposing cost basis ratio and dividend yield as configurable parameters in the UI. Users need to be able to adjust these based on their actual portfolio characteristics.

Output: New UI inputs for Sell strategy configuration wired to the calculation.
</objective>

<execution_context>
@C:\Users\ungac\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ungac\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/20-financial-calculation-audit/20-04-PLAN.md
@src/components/ui/param-section.ts
@src/components/ui/results-dashboard.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Sell strategy inputs to param-section</name>
  <files>src/components/ui/param-section.ts</files>
  <action>
Add new parameter inputs for Sell strategy configuration. Find an appropriate section (likely near Tax Modeling or create a new "Sell Strategy Comparison" section):

1. Add Cost Basis Ratio input:
```html
<div class="param-row">
  <label>
    Cost Basis Ratio
    <help-tooltip content="What fraction of your portfolio is original cost (basis) vs gains. 40% means 60% embedded gains. Affects capital gains taxes when selling."></help-tooltip>
  </label>
  <number-input
    id="cost-basis-ratio"
    value="0.4"
    min="0.05"
    max="0.95"
    step="0.05"
    suffix="%"
    multiplier="100"
  ></number-input>
</div>
```

2. Add Dividend Yield input:
```html
<div class="param-row">
  <label>
    Dividend Yield
    <help-tooltip content="Annual dividend yield of your portfolio. S&P 500 averages 1.5-2%. Growth portfolios may be lower, income portfolios higher."></help-tooltip>
  </label>
  <number-input
    id="dividend-yield"
    value="0.02"
    min="0"
    max="0.10"
    step="0.005"
    suffix="%"
    multiplier="100"
  ></number-input>
</div>
```

3. Group these in a "Sell Strategy Comparison" param-section:
```html
<param-section title="Sell Strategy Comparison" open>
  <!-- Cost Basis Ratio -->
  <!-- Dividend Yield -->
</param-section>
```

Note: Use the existing number-input component pattern. The multiplier="100" converts 0.40 to 40% for display.
  </action>
  <verify>New inputs render in UI</verify>
  <done>Cost basis and dividend yield inputs added to UI</done>
</task>

<task type="auto">
  <name>Task 2: Wire inputs to Sell strategy calculation</name>
  <files>src/components/ui/results-dashboard.ts</files>
  <action>
Update results-dashboard to read the new config values and pass them to calculateSellStrategy:

1. Find where calculateSellStrategy is called (likely in updateSellStrategy or similar method)

2. Read values from param-section inputs:
```typescript
// Get Sell strategy config from UI
const costBasisInput = document.querySelector('#cost-basis-ratio') as HTMLElement;
const dividendYieldInput = document.querySelector('#dividend-yield') as HTMLElement;

const sellConfig: SellStrategyConfig = {
  initialValue: this.initialValue,
  annualWithdrawal: this.annualWithdrawal,
  withdrawalGrowth: this.withdrawalGrowth,
  timeHorizon: this.timeHorizon,
  capitalGainsRate: this.effectiveTaxRate,
  // Read from UI inputs (fallback to defaults if not found)
  costBasisRatio: costBasisInput?.getAttribute('value')
    ? parseFloat(costBasisInput.getAttribute('value')!)
    : 0.4,
  dividendYield: dividendYieldInput?.getAttribute('value')
    ? parseFloat(dividendYieldInput.getAttribute('value')!)
    : 0.02,
  dividendTaxRate: this.effectiveTaxRate, // Use same rate for qualified dividends
};
```

3. Pass the config to calculateSellStrategy:
```typescript
const sellResult = calculateSellStrategy(sellConfig, yearlyPercentiles);
```

4. If param-section uses events, add listener:
```typescript
// Listen for param changes to recalculate
document.addEventListener('param-change', (e: CustomEvent) => {
  if (e.detail.id === 'cost-basis-ratio' || e.detail.id === 'dividend-yield') {
    this.recalculateSellStrategy();
  }
});
```
  </action>
  <verify>Changing inputs updates Sell strategy results</verify>
  <done>UI inputs wired to Sell strategy calculation</done>
</task>

</tasks>

<verification>
1. Run dev server and check UI:
   - New "Sell Strategy Comparison" section visible
   - Cost Basis Ratio shows 40% default
   - Dividend Yield shows 2% default
2. Run simulation, then change cost basis to 80%:
   - Lifetime taxes should decrease (less embedded gains)
3. Change dividend yield to 4%:
   - Dividend taxes should increase
4. Verify success rate updates when inputs change
</verification>

<success_criteria>
- Cost basis ratio configurable 5-95%
- Dividend yield configurable 0-10%
- Changes trigger Sell strategy recalculation
- Tooltips explain what each setting means
</success_criteria>

<output>
After completion, create `.planning/phases/20-financial-calculation-audit/20-10-SUMMARY.md`
</output>
