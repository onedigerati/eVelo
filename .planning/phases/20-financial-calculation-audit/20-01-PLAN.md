---
phase: 20-financial-calculation-audit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/config/calculation-defaults.ts
  - src/config/types.ts
  - src/config/index.ts
autonomous: true

must_haves:
  truths:
    - "All hardcoded calculation constants centralized in config module"
    - "Default values documented with sources and ranges"
    - "Config types exported for use across calculation modules"
  artifacts:
    - path: "src/config/calculation-defaults.ts"
      provides: "Centralized default values for all calculations"
      exports: ["DEFAULT_SELL_CONFIG", "DEFAULT_TAX_CONFIG", "DEFAULT_SBLOC_CALC_CONFIG"]
    - path: "src/config/types.ts"
      provides: "TypeScript interfaces for all configuration objects"
      exports: ["SellCalculationConfig", "TaxCalculationConfig", "SBLOCCalculationConfig"]
    - path: "src/config/index.ts"
      provides: "Barrel export for config module"
  key_links:
    - from: "src/config/calculation-defaults.ts"
      to: "src/calculations/sell-strategy.ts"
      via: "import of defaults"
      pattern: "import.*DEFAULT_SELL_CONFIG"
---

<objective>
Create centralized configuration module for all calculation constants

Purpose: Extract all hardcoded values (cost basis ratio 40%, dividend yield 2%, liquidation target 0.8x, etc.) into a single configuration module. This addresses Risk Areas #1, #2, #9, and #13 by making values configurable and consistently named.

Output: New src/config/ module with typed configuration objects and documented defaults.
</objective>

<execution_context>
@C:\Users\ungac\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ungac\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-financial-calculation-audit/20-RESEARCH.md
@src/calculations/sell-strategy.ts
@src/sbloc/types.ts
@src/simulation/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create configuration types</name>
  <files>src/config/types.ts</files>
  <action>
Create TypeScript interfaces for calculation configuration objects:

1. `SellCalculationConfig` interface:
   - costBasisRatio: number (0-1, default 0.4)
   - dividendYield: number (0-1, default 0.02)
   - dividendTaxRate: number (0-1, default matches capitalGainsRate)
   - capitalGainsRate: number (0-1, default 0.238)

2. `TaxCalculationConfig` interface:
   - federalCapitalGainsRate: number (0.238 default - includes NIIT)
   - stateCapitalGainsRate: number (0 default)
   - effectiveCapitalGainsRate: number (computed or override)
   - dividendTaxRate: number (same as capital gains for qualified)
   - estateTaxExemption: number (13.99M for 2025)

3. `SBLOCCalculationConfig` interface:
   - liquidationTargetMultiplier: number (0.8 default)
   - warningZoneBuffer: number (0.1 default - 10% below maintenance)
   - minPortfolioValue: number (0 - floor for calculations)

Add JSDoc comments documenting:
- What each value represents
- Valid ranges
- Source of default values (IRS, brokerage policies, etc.)
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Configuration type interfaces defined with full JSDoc documentation</done>
</task>

<task type="auto">
  <name>Task 2: Create default values module</name>
  <files>src/config/calculation-defaults.ts</files>
  <action>
Create module exporting default configuration constants:

```typescript
/**
 * Default Sell Strategy Configuration
 *
 * These values represent typical assumptions for taxable brokerage accounts.
 * Users should adjust based on their specific situation.
 */
export const DEFAULT_SELL_CONFIG: SellCalculationConfig = {
  // Cost basis as fraction of portfolio value
  // 40% basis = 60% embedded gains (typical for long-held portfolio)
  // Source: Reasonable assumption for 15-20 year holding period
  costBasisRatio: 0.4,

  // Annual dividend yield
  // 2% matches S&P 500 historical average (1.5-2% range)
  // Source: S&P Global historical dividend data
  dividendYield: 0.02,

  // Tax rate for qualified dividends
  // Uses same rate as long-term capital gains (23.8% with NIIT)
  // Source: IRS qualified dividend rules
  dividendTaxRate: 0.238,

  // Long-term capital gains + NIIT for high earners
  // 20% + 3.8% NIIT = 23.8%
  // Source: IRS 2025 tax brackets
  capitalGainsRate: 0.238,
};

export const DEFAULT_TAX_CONFIG: TaxCalculationConfig = {
  federalCapitalGainsRate: 0.238,
  stateCapitalGainsRate: 0,
  effectiveCapitalGainsRate: 0.238,
  dividendTaxRate: 0.238,
  estateTaxExemption: 13990000, // 2025 federal exemption
};

export const DEFAULT_SBLOC_CALC_CONFIG: SBLOCCalculationConfig = {
  // Target LTV after liquidation = maintenance * 0.8
  // Provides buffer to avoid immediate repeat margin calls
  liquidationTargetMultiplier: 0.8,

  // Warning zone starts 10% below maintenance margin
  warningZoneBuffer: 0.1,

  // Minimum portfolio value (floor for calculations)
  minPortfolioValue: 0,
};
```

Include inline comments explaining each value's source and purpose.
  </action>
  <verify>File exports constants correctly: `npx tsc --noEmit`</verify>
  <done>Default configuration constants exported with documentation</done>
</task>

<task type="auto">
  <name>Task 3: Create barrel export and integrate</name>
  <files>src/config/index.ts</files>
  <action>
Create barrel export file:

```typescript
/**
 * Configuration Module
 *
 * Centralized configuration for all financial calculations.
 * Import from here to access defaults and types.
 */

export type {
  SellCalculationConfig,
  TaxCalculationConfig,
  SBLOCCalculationConfig,
} from './types';

export {
  DEFAULT_SELL_CONFIG,
  DEFAULT_TAX_CONFIG,
  DEFAULT_SBLOC_CALC_CONFIG,
} from './calculation-defaults';
```

This establishes the config module as the single source of truth for calculation parameters.
  </action>
  <verify>`npx tsc --noEmit` passes; imports resolve correctly</verify>
  <done>Config module barrel export created and ready for use</done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` - should pass with no errors
2. Verify src/config/ directory contains all 3 files
3. Check that all constants have JSDoc documentation
4. Verify DEFAULT_SELL_CONFIG.costBasisRatio === 0.4
5. Verify DEFAULT_TAX_CONFIG.federalCapitalGainsRate === 0.238
</verification>

<success_criteria>
- All calculation defaults centralized in one module
- Types are fully documented with JSDoc
- Module exports cleanly via barrel file
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/20-financial-calculation-audit/20-01-SUMMARY.md`
</output>
