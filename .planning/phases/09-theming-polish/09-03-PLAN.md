---
phase: 09-theming-polish
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/styles/print.css
  - src/style.css
  - src/components/ui/help-tooltip.ts
  - src/components/ui/index.ts
  - src/components/ui/sidebar-panel.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Print-friendly report generates correctly without UI chrome"
    - "Charts and tables do not split across page breaks"
    - "Help tooltips provide contextual information on hover/focus"
    - "Tooltips are accessible (keyboard navigable, screen reader friendly)"
  artifacts:
    - path: "src/styles/print.css"
      provides: "Print-specific styles hiding UI, preventing page breaks"
      contains: "@media print"
    - path: "src/components/ui/help-tooltip.ts"
      provides: "Accessible tooltip Web Component"
      exports: ["HelpTooltip"]
  key_links:
    - from: "src/style.css"
      to: "src/styles/print.css"
      via: "CSS import"
      pattern: "@import.*print\\.css"
    - from: "src/components/ui/help-tooltip.ts"
      to: "aria-describedby"
      via: "ARIA tooltip pattern"
      pattern: "aria-describedby"
---

<objective>
Create print-friendly layout and accessible help tooltips for contextual guidance.

Purpose: Enable users to print simulation results as a clean report. Provide inline help content that explains financial concepts and metrics without cluttering the UI.

Output: Print styles that hide navigation and prevent page break issues. Help tooltip component for use throughout the app.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-theming-polish/09-RESEARCH.md
@.planning/phases/09-theming-polish/09-01-SUMMARY.md

# Existing styles and components
@src/style.css
@src/components/ui/sidebar-panel.ts
@src/components/ui/results-dashboard.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create print-friendly CSS</name>
  <files>src/styles/print.css, src/style.css</files>
  <action>
Create print.css with styles that produce a clean, printable report.

**Create src/styles/print.css:**
```css
/**
 * Print Styles for eVelo
 *
 * Produces clean printable reports by:
 * - Hiding interactive UI elements (sidebar, buttons, settings)
 * - Preventing awkward page breaks in charts and tables
 * - Optimizing layout for paper
 */

@media print {
  /* Hide interactive UI elements */
  sidebar-panel,
  settings-panel,
  theme-toggle,
  .no-print,
  button:not(.print-visible),
  [role="navigation"],
  header nav,
  footer {
    display: none !important;
  }

  /* Reset body for print */
  body {
    font-size: 11pt;
    line-height: 1.4;
    color: #000 !important;
    background: #fff !important;
    margin: 0;
    padding: 0;
  }

  /* Main layout becomes single column */
  main-layout {
    display: block !important;
  }

  /* Results dashboard takes full width */
  results-dashboard,
  comparison-dashboard {
    width: 100% !important;
    max-width: none !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* Prevent breaking important sections */
  .chart-container,
  .metric-card,
  .key-metrics-banner,
  .param-summary,
  .strategy-analysis,
  .percentile-spectrum,
  table,
  [class*="section"],
  [class*="card"] {
    break-inside: avoid;
    page-break-inside: avoid; /* Legacy support */
  }

  /* Force page breaks before major sections */
  .section-break,
  .print-page-break {
    break-before: page;
    page-break-before: always; /* Legacy support */
  }

  /* Ensure charts render at reasonable size */
  canvas {
    max-width: 100% !important;
    height: auto !important;
    min-height: 200px;
  }

  /* Tables should be readable */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 10pt;
  }

  th, td {
    border: 1px solid #ccc !important;
    padding: 4px 8px !important;
  }

  th {
    background: #f5f5f5 !important;
    color: #000 !important;
  }

  /* Links show URL in print */
  a[href^="http"]::after {
    content: " (" attr(href) ")";
    font-size: 9pt;
    color: #666;
  }

  /* Remove shadows and fancy effects */
  * {
    box-shadow: none !important;
    text-shadow: none !important;
  }

  /* Ensure text is black for readability */
  h1, h2, h3, h4, h5, h6,
  p, span, div, li {
    color: #000 !important;
  }

  /* Secondary text can be slightly lighter */
  .text-secondary,
  [class*="secondary"] {
    color: #444 !important;
  }
}

/* Page setup */
@page {
  size: letter portrait;
  margin: 0.75in;
}

@page :first {
  margin-top: 1in;
}
```

**Update src/style.css:**
Add import at the top (after other imports if any):
```css
@import './styles/print.css';
```

If style.css doesn't have other imports, just add this line.
  </action>
  <verify>
1. `npm run build` succeeds
2. Open app in browser, run a simulation
3. Press Ctrl+P (or Cmd+P on Mac) to open print preview
4. Sidebar should be hidden
5. Charts and tables should not split across pages
6. Text should be readable (black on white)
  </verify>
  <done>Print preview shows clean report without UI chrome. No awkward page breaks.</done>
</task>

<task type="auto">
  <name>Task 2: Create accessible help tooltip component</name>
  <files>src/components/ui/help-tooltip.ts, src/components/ui/index.ts</files>
  <action>
Create HelpTooltip Web Component following WCAG 1.4.13 requirements.

**Component attributes:**
- `content`: Text content to display in tooltip
- `position`: 'top' | 'bottom' | 'left' | 'right' (default: 'top')

**Template structure:**
```html
<button class="help-trigger" aria-describedby="tooltip-{id}" type="button">
  <svg width="14" height="14" viewBox="0 0 14 14" aria-hidden="true">
    <!-- Question mark in circle -->
    <circle cx="7" cy="7" r="6" fill="none" stroke="currentColor" stroke-width="1.5"/>
    <text x="7" y="10" text-anchor="middle" font-size="9" fill="currentColor">?</text>
  </svg>
</button>
<div role="tooltip" id="tooltip-{id}" class="tooltip-content {position}" aria-hidden="true">
  {content}
</div>
```

**Behavior (WCAG 1.4.13 compliant):**
1. **Hoverable:** Show on mouseenter trigger or tooltip, hide on mouseleave both
2. **Focusable:** Show on focus, hide on blur
3. **Dismissable:** Hide on Escape key
4. **Persistent:** Tooltip stays visible while hovering over it

**Event listeners:**
```typescript
// Show
trigger.addEventListener('mouseenter', show);
trigger.addEventListener('focus', show);
tooltip.addEventListener('mouseenter', show);

// Hide
trigger.addEventListener('mouseleave', delayedHide);
trigger.addEventListener('blur', hide);
tooltip.addEventListener('mouseleave', hide);

// Dismiss
trigger.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') { hide(); trigger.blur(); }
});
```

Use 100ms delay on mouseleave to allow moving to tooltip.

**Styles:**
- Trigger: 14x14px, inline-flex, secondary text color, cursor: help
- Tooltip: absolute positioned, white/dark bg based on theme, shadow, max-width 250px
- Position variants: top (bottom: calc(100% + 8px)), bottom, left, right
- Transition: opacity 0.15s ease
- z-index: 1000

**Generate unique ID:**
```typescript
private tooltipId = `tooltip-${Math.random().toString(36).substr(2, 9)}`;
```

**Register element and update index.ts:**
```typescript
customElements.define('help-tooltip', HelpTooltip);
```
  </action>
  <verify>
1. `npm run build` succeeds
2. Add `<help-tooltip content="Test help text"></help-tooltip>` to a component
3. Hover - tooltip appears above trigger
4. Tab to focus - tooltip appears
5. Press Escape - tooltip hides
6. Hover tooltip itself - stays visible
  </verify>
  <done>HelpTooltip component renders with accessible hover/focus/escape behavior.</done>
</task>

<task type="auto">
  <name>Task 3: Add help tooltips to key financial terms in sidebar</name>
  <files>src/components/ui/sidebar-panel.ts</files>
  <action>
Add help tooltips to explain key financial concepts in the sidebar parameter sections.

**Import help-tooltip:**
```typescript
import './help-tooltip';
```

**Add tooltips to these parameters (update template):**

1. **LTV Limit** - Add after label:
```html
<help-tooltip content="Loan-to-Value ratio. Maximum percentage of your portfolio value you can borrow. Lower LTV = more conservative."></help-tooltip>
```

2. **Maintenance Margin** - Add after label:
```html
<help-tooltip content="LTV threshold that triggers a margin call. If your loan exceeds this ratio of portfolio value, you must repay or liquidate."></help-tooltip>
```

3. **SBLOC Interest Rate** - Add after label:
```html
<help-tooltip content="Annual interest rate charged on your securities-backed line of credit. Typically SOFR + 1-3%."></help-tooltip>
```

4. **Annual Withdrawal** - Add after label:
```html
<help-tooltip content="Tax-free income from borrowing against your portfolio. Unlike selling, this doesn't trigger capital gains taxes."></help-tooltip>
```

5. **Time Horizon** - Add after label:
```html
<help-tooltip content="Investment period in years. Longer horizons typically show more benefit from the Buy-Borrow-Die strategy."></help-tooltip>
```

6. **Simulation Iterations** - Add after label:
```html
<help-tooltip content="Number of Monte Carlo scenarios to simulate. More iterations = more accurate results but slower computation."></help-tooltip>
```

**Styling note:**
Tooltips should appear inline with labels. May need to adjust label container to `display: inline-flex; align-items: center; gap: 4px;`
  </action>
  <verify>
1. Open app, expand parameter sections
2. See question mark icons next to labels
3. Hover/focus icons - explanatory tooltips appear
4. Text explains the concept clearly
5. Tooltips don't overflow or obscure important UI
  </verify>
  <done>Sidebar parameters have contextual help tooltips explaining financial concepts.</done>
</task>

</tasks>

<verification>
1. `npm run build` - No TypeScript errors
2. Print preview (Ctrl+P):
   - Sidebar hidden
   - Charts visible and complete
   - No awkward page breaks
   - Text is black on white
3. Help tooltips:
   - Question mark icons visible next to key parameters
   - Hover shows tooltip above trigger
   - Focus shows tooltip (keyboard accessible)
   - Escape dismisses tooltip
   - Can hover over tooltip itself (persistent)
4. No console errors
</verification>

<success_criteria>
- Print layout hides sidebar and interactive elements
- Charts and tables don't split across page breaks
- Help tooltip component is WCAG 1.4.13 compliant
- Key financial terms have explanatory tooltips
- All tooltips are keyboard accessible
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-theming-polish/09-03-SUMMARY.md`
</output>
