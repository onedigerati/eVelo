---
phase: 27-dashboard-fab-navigation
plan: 02
type: execute
wave: 2
depends_on: ["27-01"]
files_modified:
  - src/components/ui/comparison-dashboard.ts
  - src/components/ui/results-dashboard.ts
  - src/components/app-root.ts
autonomous: false

must_haves:
  truths:
    - "FAB only appears after simulation results are displayed (not on welcome screen)"
    - "FAB appears in both single dashboard and comparison dashboard modes"
    - "FAB menu items navigate correctly to visible sections"
    - "FAB works in light and dark themes visually"
    - "FAB touch target is at least 48px for mobile accessibility"
  artifacts:
    - path: "src/components/ui/comparison-dashboard.ts"
      provides: "FAB integration in comparison mode"
      contains: "fab-navigation"
    - path: "src/components/ui/results-dashboard.ts"
      provides: "FAB integration in single dashboard"
      contains: "fab-navigation"
  key_links:
    - from: "app-root.ts"
      to: "fab-navigation"
      via: "simulation-complete event triggers fab.show()"
      pattern: "fab.*show"
    - from: "comparison-dashboard.ts"
      to: "fab-navigation"
      via: "contains fab-navigation element"
      pattern: "<fab-navigation"
---

<objective>
Wire FAB navigation to the application and verify full functionality.

Purpose: Integrate the FAB component so it appears at the right time (after simulation results) and functions correctly across all dashboard views.

Output:
- FAB integrated into comparison-dashboard and results-dashboard
- Visibility controlled by simulation state
- Human verification of visual appearance and interaction
</objective>

<execution_context>
@C:\Users\ungac\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ungac\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-dashboard-fab-navigation/27-RESEARCH.md
@.planning/phases/27-dashboard-fab-navigation/27-01-SUMMARY.md
@src/components/ui/fab-navigation.ts
@src/components/ui/comparison-dashboard.ts
@src/components/ui/results-dashboard.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate FAB into Dashboards</name>
  <files>src/components/ui/comparison-dashboard.ts, src/components/ui/results-dashboard.ts</files>
  <action>
**In results-dashboard.ts:**

1. Add import at the top (after other imports):
```typescript
import './fab-navigation';
```

2. In the template() method, add the FAB element just before the closing `</div>` of the main container:
```html
<fab-navigation id="fab-nav"></fab-navigation>
```

3. In the `updateCharts()` method (or wherever dashboard shows results), show the FAB:
```typescript
// At the end of updateCharts(), after all chart updates:
const fab = this.$('#fab-nav') as FabNavigation | null;
if (this._data) {
  fab?.show();
} else {
  fab?.hide();
}
```

4. Add type import at top:
```typescript
import type { FabNavigation } from './fab-navigation';
```

**In comparison-dashboard.ts:**

1. Add import at the top:
```typescript
import './fab-navigation';
import type { FabNavigation } from './fab-navigation';
```

2. In the template() method, add the FAB element at the end of the container (before closing `</div>`):
```html
<fab-navigation id="fab-nav"></fab-navigation>
```

3. In the method that updates display after comparison state changes (likely in `updateDisplay()` or similar), show the FAB:
```typescript
const fab = this.$('#fab-nav') as FabNavigation | null;
fab?.show();
```

4. When exiting comparison mode, the FAB in results-dashboard will take over - no need to explicitly hide here as the component is replaced.

**Important considerations:**
- The FAB should have `position: fixed` so it stays at bottom-right regardless of scroll position
- Both dashboards can have their own FAB instance - only one will be visible at a time since only one dashboard is shown
- The FAB's scrollToSection method needs to find sections in whichever dashboard is active
  </action>
  <verify>
1. Run `grep -n "fab-navigation" src/components/ui/results-dashboard.ts` - should show import and element
2. Run `grep -n "fab-navigation" src/components/ui/comparison-dashboard.ts` - should show import and element
3. Run `npm run build` - TypeScript compiles without errors
  </verify>
  <done>
FAB navigation component integrated into both dashboard components:
- Imported and included in template
- Visibility controlled based on data presence
- Ready for manual verification
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete FAB navigation system:
1. FAB button at bottom-right of dashboard (teal, 56px, circular)
2. Popup menu with 8 dashboard section links
3. Click-outside and Escape dismissal
4. Smooth scroll to sections
5. Light and dark theme support
6. Mobile touch support (48px+ touch target)
  </what-built>
  <how-to-verify>
**Pre-requisite:** Run a simulation first to show the dashboard.

1. **Verify FAB Appearance:**
   - Open http://localhost:5173 in browser
   - Confirm FAB does NOT appear on welcome screen
   - Run a simulation (click "Run Monte Carlo Simulation")
   - Confirm FAB appears at bottom-right after results display
   - FAB should be a teal circular button with icon

2. **Test Menu Open/Close:**
   - Click FAB button - menu should animate open (scale + fade)
   - Click FAB again - menu should close
   - Click outside menu - should close
   - Press Escape - should close

3. **Test Navigation:**
   - Open menu and click "Key Metrics" - page should smooth scroll to Key Metrics section
   - Open menu and click "Yearly Analysis" - should scroll to bottom tables
   - Try several other sections to verify scrolling works

4. **Test Keyboard Navigation:**
   - Tab to FAB button (should show focus ring)
   - Press Enter or Space - menu opens
   - Press ArrowDown - focus moves through menu items
   - Press Enter on menu item - navigates to section
   - Press Escape - menu closes, focus returns to FAB

5. **Test Theme Switching:**
   - Toggle to dark theme
   - Verify FAB button has appropriate dark theme styling
   - Verify menu has dark background with readable text
   - Toggle back to light theme - verify consistent appearance

6. **Test Mobile/Touch:**
   - Open DevTools, toggle device toolbar (Ctrl+Shift+M)
   - Select a mobile viewport (e.g., iPhone 12)
   - Verify FAB is still visible and accessible
   - Verify touch target is comfortable (not too small)
   - Test tap to open menu, tap section to navigate

7. **Test Comparison Mode:**
   - If comparison mode is available, enter it
   - Verify FAB appears and functions in comparison view
   - Navigation should scroll to sections within visible dashboard
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. FAB only visible after simulation results
2. Menu opens/closes correctly
3. Section navigation works via smooth scroll
4. Keyboard accessible
5. Theme-aware styling
6. Mobile-friendly touch targets
</verification>

<success_criteria>
- FAB appears only after simulation runs
- Menu contains correct section links
- Navigation scrolls to correct sections
- Escape and click-outside close menu
- Works in both light and dark themes
- Touch-friendly on mobile devices
- User approves checkpoint verification
</success_criteria>

<output>
After completion, create `.planning/phases/27-dashboard-fab-navigation/27-02-SUMMARY.md`
</output>
