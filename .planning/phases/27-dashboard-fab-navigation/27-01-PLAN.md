---
phase: 27-dashboard-fab-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/fab-navigation.ts
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "FAB button renders at bottom-right of viewport"
    - "Clicking FAB opens a menu with section links"
    - "Clicking menu item scrolls to corresponding dashboard section"
    - "Clicking outside menu or pressing Escape closes menu"
    - "FAB uses teal primary color matching eVelo brand"
    - "Menu works correctly in both light and dark themes"
  artifacts:
    - path: "src/components/ui/fab-navigation.ts"
      provides: "FAB navigation component with menu"
      min_lines: 200
      exports: ["FabNavigation"]
    - path: "src/components/ui/index.ts"
      provides: "Barrel export for fab-navigation"
      contains: "FabNavigation"
  key_links:
    - from: "fab-navigation.ts"
      to: "base-component.ts"
      via: "extends BaseComponent"
      pattern: "extends BaseComponent"
    - from: "fab-navigation menu items"
      to: "results-dashboard sections"
      via: "scrollIntoView on click"
      pattern: "scrollIntoView"
---

<objective>
Create the FAB navigation component for dashboard section navigation.

Purpose: Provide quick access to dashboard sections via a floating action button that opens a styled menu, enabling users to navigate long results pages efficiently.

Output: A fully functional fab-navigation Web Component with:
- FAB button (56px, teal, positioned bottom-right)
- Popup menu with dashboard section links
- Smooth scroll to sections on click
- Click-outside and Escape dismissal
- ARIA menu button accessibility pattern
- Theme-aware styling
</objective>

<execution_context>
@C:\Users\ungac\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ungac\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-dashboard-fab-navigation/27-RESEARCH.md
@src/components/base-component.ts
@src/components/ui/modal-dialog.ts
@src/components/ui/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FAB Navigation Component</name>
  <files>src/components/ui/fab-navigation.ts</files>
  <action>
Create a new Web Component extending BaseComponent with the following implementation:

**Component Structure:**
- Class `FabNavigation` extending `BaseComponent`
- Private state: `_isOpen: boolean`, `_isVisible: boolean`
- Static `observedAttributes`: ['visible']
- Public methods: `show()`, `hide()`, `open()`, `close()`, `toggle()`

**Template (template() method):**
- Container div with `position: fixed`, `bottom: 24px`, `right: 24px`, `z-index: 999`
- FAB button (56px circle) with:
  - Inline SVG icon (navigation/list icon - three horizontal lines with dots or chart icon)
  - `aria-haspopup="menu"`, `aria-expanded`, `aria-controls="fab-menu"`, `aria-label="Jump to section"`
- Menu `<ul>` with `role="menu"`, `id="fab-menu"`:
  - 8 menu items for main sections:
    1. Key Metrics (key-metrics-section)
    2. Parameters (param-summary-section)
    3. Portfolio Outlook (net-worth-spectrum-section)
    4. Strategy Analysis (strategy-analysis-section)
    5. Visual Comparison (visual-comparison-section)
    6. Recommendations (recommendations-section)
    7. Performance Tables (performance-table-section)
    8. Yearly Analysis (yearly-analysis-section)
  - Each item: `<li role="none"><a role="menuitem" tabindex="-1" data-section="[id]">[Label]</a></li>`

**Styles (styles() method):**
- FAB container: `position: fixed`, `bottom: calc(24px + env(safe-area-inset-bottom, 0px))`, `right: calc(24px + env(safe-area-inset-right, 0px))`, `z-index: 999`
- FAB button: 56px circle, `background: var(--color-primary, #0d9488)`, `color: var(--text-inverse, #ffffff)`, `box-shadow: var(--shadow-lg)`, hover scale(1.05), focus-visible outline
- Menu: positioned above button (`bottom: calc(100% + 8px)`), `right: 0`, `background: var(--surface-primary)`, `border-radius: var(--border-radius-lg, 12px)`, `box-shadow: var(--shadow-lg)`, `min-width: 200px`
- Menu open/closed states: use opacity, visibility, transform (translateY + scale) for smooth transition
- Menu items: padding, hover background `var(--surface-secondary)`, teal text on hover
- Reduced motion support: `@media (prefers-reduced-motion: reduce)` removes transitions
- Hidden when not visible: `aria-hidden="true"` and `display: none` when `_isVisible` is false

**Event Handling (afterRender() method):**
1. FAB button click: toggle menu open/close
2. Menu item click: call `scrollToSection(sectionId)`, then close menu
3. Document click listener for click-outside: use `composedPath().includes(this)` pattern (NOT `event.target`)
4. Keyboard navigation:
   - On FAB: Enter/Space/ArrowDown opens menu and focuses first item, ArrowUp opens and focuses last
   - In menu: ArrowDown/ArrowUp move focus, Escape closes and returns focus to FAB, Home/End jump to first/last, Tab closes menu
5. Register click listener in afterRender, clean up in disconnectedCallback

**Scroll Navigation:**
- Method `scrollToSection(sectionId: string)`:
  - Query through Shadow DOM chain: `document.querySelector('main-layout')?.shadowRoot?.querySelector('.main-content')` to find the dashboard
  - Then query for `comparison-dashboard` or `results-dashboard` within main-content
  - Finally query within dashboard's shadowRoot for `#${sectionId}`
  - Call `element.scrollIntoView({ behavior: 'smooth', block: 'start' })`
  - Close the menu after initiating scroll

**Visibility Methods:**
- `show()`: set `_isVisible = true`, set 'visible' attribute, re-render
- `hide()`: set `_isVisible = false`, remove 'visible' attribute, also close menu, re-render

DO NOT:
- Use external icon libraries (inline SVG only)
- Use `event.target` for click-outside (fails with Shadow DOM - use composedPath)
- Set z-index higher than 999 (modals are at 1000)
  </action>
  <verify>
1. File exists at src/components/ui/fab-navigation.ts
2. Class exports `FabNavigation`
3. Has `customElements.define('fab-navigation', FabNavigation)` at bottom
4. Contains `extends BaseComponent`
5. Contains `composedPath` for click-outside detection
6. Contains `scrollIntoView` for navigation
7. Contains ARIA attributes (aria-haspopup, role="menu", role="menuitem")
  </verify>
  <done>
FAB component file created with:
- BaseComponent extension pattern
- Template with FAB button and menu
- Theme-aware CSS with transitions
- Keyboard navigation (W3C Menu Button Pattern)
- Click-outside detection using composedPath
- Scroll-to-section navigation through Shadow DOM
- Visibility control via show/hide methods
  </done>
</task>

<task type="auto">
  <name>Task 2: Export FAB Component from Barrel</name>
  <files>src/components/ui/index.ts</files>
  <action>
Add export for the new FAB navigation component:

1. Add import/export line at the end of the file (before any closing comment if present):
```typescript
// Navigation Components
export { FabNavigation } from './fab-navigation';
```

2. Position it after the "Welcome Components" section, creating a new "Navigation Components" section.

This ensures the component is available when other parts of the app import from '@/components/ui'.
  </action>
  <verify>
1. Run: `grep -n "FabNavigation" src/components/ui/index.ts` - should show export line
2. Run: `npx tsc --noEmit` - TypeScript compiles without errors
  </verify>
  <done>
FabNavigation component exported from barrel file, available for import by other components.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npm run build`
2. FAB component file exists and has correct structure
3. Export available in barrel file
4. Component follows established BaseComponent patterns
</verification>

<success_criteria>
- fab-navigation.ts file created with ~250+ lines
- Component extends BaseComponent
- ARIA accessibility attributes present
- Click-outside uses composedPath (not event.target)
- Scroll navigation traverses Shadow DOM chain
- Theme tokens used for all colors
- Barrel export added to index.ts
- `npm run build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/27-dashboard-fab-navigation/27-01-SUMMARY.md`
</output>
