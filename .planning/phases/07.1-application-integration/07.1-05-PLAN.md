---
phase: 07.1-application-integration
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app-root.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Asset selector displays available bundled assets (SPY, QQQ, IWM, AGG)"
    - "User can search/filter assets in the selector"
    - "User can select up to 5 assets from the selector"
    - "Weight editor updates when asset selection changes"
    - "Simulation uses assets from selector (not hardcoded)"
  artifacts:
    - path: "src/components/app-root.ts"
      provides: "Asset selector wired into workflow"
      contains: "asset-selector"
  key_links:
    - from: "asset-selector selection-change"
      to: "weight-editor assets attribute"
      via: "event handler updates weight-editor"
    - from: "weight-editor"
      to: "collectSimulationParams"
      via: "getWeights() provides selected assets"
---

<objective>
Integrate asset-selector component into app-root workflow.

Purpose: Close the gap identified by verification â€” users currently see only hardcoded assets (SPY, BND, GLD) instead of being able to search/filter/select from available bundled presets.

Output: Asset selector in sidebar that populates weight-editor with user-selected assets.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-application-integration/07.1-VERIFICATION.md

# Existing code to modify
@src/components/app-root.ts
@src/components/ui/asset-selector.ts
@src/data/services/preset-service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add asset-selector to app-root template</name>
  <files>src/components/app-root.ts</files>
  <action>
1. Import getPresetSymbols from preset-service
2. In the template, add asset-selector ABOVE the weight-editor in the "Asset Allocation" param-section:
   ```html
   <asset-selector
     id="asset-selector"
     assets='["SPY","QQQ","IWM","AGG"]'
     selected='["SPY","AGG"]'
     max-selection="5"
   ></asset-selector>
   ```
   Note: Use static JSON for assets attribute initially (SPY, QQQ, IWM, AGG from bundled presets)

3. Set default selected to ["SPY", "AGG"] (a simple stock+bond combo)

4. Update weight-editor default assets to match selected:
   ```html
   <weight-editor
     id="weight-editor"
     assets='[{"id":"SPY","name":"S&P 500","weight":70},{"id":"AGG","name":"Aggregate Bond","weight":30}]'
   ></weight-editor>
   ```
  </action>
  <verify>npm run build passes, app-root template includes asset-selector element</verify>
  <done>Asset selector visible in Asset Allocation section with bundled presets listed</done>
</task>

<task type="auto">
  <name>Task 2: Wire selection-change event to update weight-editor</name>
  <files>src/components/app-root.ts</files>
  <action>
In afterRender(), add event listener for asset-selector:

```typescript
// Handle asset selection changes
const assetSelector = this.$('#asset-selector') as HTMLElement & { getSelected(): string[] };
const weightEditor = this.$('#weight-editor') as HTMLElement;

assetSelector?.addEventListener('selection-change', (e: Event) => {
  const { selected } = (e as CustomEvent).detail as { selected: string[] };

  // Get current weights from editor
  const currentWeights = (weightEditor as any)?.getWeights?.() || {};

  // Build new assets array
  // - Keep existing weights for assets still selected
  // - Add new assets with equal distribution of remaining weight
  const existingTotal = selected
    .filter(s => s in currentWeights)
    .reduce((sum, s) => sum + currentWeights[s], 0);

  const newAssets = selected.filter(s => !(s in currentWeights));
  const remainingWeight = 100 - existingTotal;
  const newWeight = newAssets.length > 0 ? remainingWeight / newAssets.length : 0;

  // Map to weight-editor format
  const assets = selected.map(symbol => {
    const existingWeight = currentWeights[symbol];
    return {
      id: symbol,
      name: getAssetName(symbol),
      weight: existingWeight !== undefined ? existingWeight : Math.round(newWeight)
    };
  });

  weightEditor.setAttribute('assets', JSON.stringify(assets));
});
```

Also add a helper function getAssetName() that maps symbols to display names:
```typescript
function getAssetName(symbol: string): string {
  const names: Record<string, string> = {
    SPY: 'S&P 500',
    QQQ: 'Nasdaq 100',
    IWM: 'Russell 2000',
    AGG: 'Aggregate Bond'
  };
  return names[symbol] || symbol;
}
```
  </action>
  <verify>npm run build passes</verify>
  <done>Selecting/deselecting assets in selector updates weight-editor immediately</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Asset selector appears in Asset Allocation section
- [ ] Asset selector shows 4 bundled presets (SPY, QQQ, IWM, AGG)
- [ ] Selecting an asset adds it to weight-editor
- [ ] Deselecting an asset removes it from weight-editor
- [ ] Weights distribute reasonably when adding new assets
</verification>

<success_criteria>
- All tasks completed
- Asset selector integrated into sidebar
- Selection changes update weight-editor
- No hardcoded assets in weight-editor (populated from selector)
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-application-integration/07.1-05-SUMMARY.md`
</output>
