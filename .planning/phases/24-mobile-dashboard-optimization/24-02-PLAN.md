---
phase: 24-mobile-dashboard-optimization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/yearly-analysis-table.ts
  - src/components/ui/sell-yearly-analysis-table.ts
  - src/components/ui/performance-table.ts
  - src/components/ui/return-probability-table.ts
autonomous: true

must_haves:
  truths:
    - "Tables are horizontally scrollable on mobile"
    - "Tables show visual scroll indicators on mobile"
    - "Touch interactions work reliably for horizontal scroll"
  artifacts:
    - path: "src/components/ui/yearly-analysis-table.ts"
      provides: "Scrollable table with visual indicators"
      contains: "scroll-indicator"
    - path: "src/components/ui/sell-yearly-analysis-table.ts"
      provides: "Scrollable table with visual indicators"
      contains: "scroll-indicator"
    - path: "src/components/ui/performance-table.ts"
      provides: "Scrollable table with visual indicators"
      contains: "scroll-indicator"
    - path: "src/components/ui/return-probability-table.ts"
      provides: "Scrollable table with visual indicators"
      contains: "scroll-indicator"
  key_links:
    - from: "yearly-analysis-table.ts"
      to: "user touch"
      via: "-webkit-overflow-scrolling: touch"
      pattern: "webkit-overflow-scrolling"
---

<objective>
Add visual scroll indicators to all table components so mobile users know they can scroll horizontally. Currently tables have horizontal scroll enabled but users can't tell content exists beyond the visible edge.

Purpose: Research shows users perceive tables as "broken" when scrollable content isn't visually indicated. Adding scroll hints improves mobile UX significantly.
Output: All 4 table components have visible scroll indicators (gradient fade or arrow hints) on mobile.
</objective>

<execution_context>
@C:\Users\ungac\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ungac\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/24-mobile-dashboard-optimization/24-RESEARCH.md
@src/components/ui/yearly-analysis-table.ts
@src/components/ui/performance-table.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll indicators to yearly-analysis-table.ts</name>
  <files>src/components/ui/yearly-analysis-table.ts</files>
  <action>
Update yearly-analysis-table.ts to show visual scroll indicators on mobile:

1. Update the template() method to wrap the table-wrapper with scroll indicator elements:
   ```typescript
   protected template(): string {
     return `
       <div class="table-container">
         <div class="table-header">
           <span class="table-icon">&#x1F4CA;</span>
           <h3>Year-by-Year Percentile Analysis</h3>
         </div>
         <div class="scroll-container">
           <div class="scroll-indicator-left" aria-hidden="true"></div>
           <div class="table-wrapper">
             <table class="analysis-table" id="analysis-table">
               <!-- existing table content -->
             </table>
           </div>
           <div class="scroll-indicator-right" aria-hidden="true"></div>
         </div>
       </div>
     `;
   }
   ```

2. Add scroll indicator styles to the styles() method:
   ```css
   .scroll-container {
     position: relative;
   }

   .scroll-indicator-left,
   .scroll-indicator-right {
     display: none;  /* Hidden by default */
   }

   @media (max-width: 768px) {
     .scroll-indicator-left,
     .scroll-indicator-right {
       display: block;
       position: absolute;
       top: 0;
       bottom: 0;
       width: 20px;
       pointer-events: none;
       z-index: 15;
       opacity: 0;
       transition: opacity 0.2s ease;
     }

     .scroll-indicator-left {
       left: 0;
       background: linear-gradient(to right, var(--surface-primary, #ffffff) 0%, transparent 100%);
     }

     .scroll-indicator-right {
       right: 0;
       background: linear-gradient(to left, var(--surface-primary, #ffffff) 0%, transparent 100%);
     }

     /* Show indicators based on scroll position */
     .scroll-container.can-scroll-left .scroll-indicator-left {
       opacity: 1;
     }

     .scroll-container.can-scroll-right .scroll-indicator-right {
       opacity: 1;
     }

     .table-wrapper {
       scroll-behavior: smooth;
       overscroll-behavior-x: contain;
     }
   }
   ```

3. Add JavaScript to detect scroll position and update indicator classes. Add to afterRender():
   ```typescript
   protected override afterRender(): void {
     this.updateTable();
     this.setupScrollIndicators();
   }

   private setupScrollIndicators(): void {
     const wrapper = this.$('.table-wrapper') as HTMLElement;
     const container = this.$('.scroll-container') as HTMLElement;

     if (!wrapper || !container) return;

     const updateIndicators = () => {
       const canScrollLeft = wrapper.scrollLeft > 0;
       const canScrollRight = wrapper.scrollLeft < (wrapper.scrollWidth - wrapper.clientWidth - 1);

       container.classList.toggle('can-scroll-left', canScrollLeft);
       container.classList.toggle('can-scroll-right', canScrollRight);
     };

     wrapper.addEventListener('scroll', updateIndicators, { passive: true });
     // Initial check
     setTimeout(updateIndicators, 100);
   }
   ```
  </action>
  <verify>
Build succeeds: `npm run build`
Mobile DevTools at 375px: Table shows right gradient indicating more content to scroll
After scrolling right, left gradient appears
  </verify>
  <done>
yearly-analysis-table.ts has scroll-container with gradient indicators that appear based on scroll position
  </done>
</task>

<task type="auto">
  <name>Task 2: Add scroll indicators to remaining table components</name>
  <files>src/components/ui/sell-yearly-analysis-table.ts, src/components/ui/performance-table.ts, src/components/ui/return-probability-table.ts</files>
  <action>
Apply the same scroll indicator pattern to the remaining three table components.

**For each file (sell-yearly-analysis-table.ts, performance-table.ts, return-probability-table.ts):**

1. Update template() to wrap table-wrapper with scroll-container and indicators:
   - Add `<div class="scroll-container">` around `.table-wrapper`
   - Add `<div class="scroll-indicator-left" aria-hidden="true"></div>` before table-wrapper
   - Add `<div class="scroll-indicator-right" aria-hidden="true"></div>` after table-wrapper

2. Add the same CSS styles from Task 1:
   - .scroll-container position: relative
   - .scroll-indicator-left/right with gradient backgrounds
   - Mobile media query to show indicators
   - .can-scroll-left/right opacity rules

3. Add setupScrollIndicators() method:
   - Copy the same implementation from Task 1
   - Call from afterRender()

Note: Each component may have slightly different table-wrapper selectors or structure. Adapt the selectors accordingly:
- performance-table.ts may have multiple tables - apply to the outermost scrollable container
- return-probability-table.ts may have multiple tables - wrap each if needed, or just the outer container

If a component already has a scroll container, just add the indicator divs and CSS.
  </action>
  <verify>
Build succeeds: `npm run build`
Mobile DevTools at 375px:
- sell-yearly-analysis-table shows scroll indicators
- performance-table shows scroll indicators
- return-probability-table shows scroll indicators
  </verify>
  <done>
All 4 table components have scroll-container with gradient indicators appearing on scroll
  </done>
</task>

<task type="auto">
  <name>Task 3: Ensure consistent touch scroll behavior</name>
  <files>src/components/ui/yearly-analysis-table.ts, src/components/ui/sell-yearly-analysis-table.ts, src/components/ui/performance-table.ts, src/components/ui/return-probability-table.ts</files>
  <action>
Verify and ensure all table components have proper touch scroll CSS:

1. In each component's mobile media query, ensure .table-wrapper has:
   ```css
   .table-wrapper {
     overflow-x: auto;
     -webkit-overflow-scrolling: touch;
     scroll-behavior: smooth;
     overscroll-behavior-x: contain;  /* Prevents page bounce on iOS */
   }
   ```

2. Ensure tables have min-width to force horizontal scroll:
   ```css
   .analysis-table {
     min-width: 600px;  /* Adjust based on table content */
   }
   ```

3. Add touch-action rule to prevent vertical scroll interference:
   ```css
   .table-wrapper {
     touch-action: pan-x pan-y;  /* Allow both directions */
   }
   ```

4. For return-probability-table.ts specifically (if it has multiple tables), ensure each has proper scroll wrapper:
   ```css
   .expected-returns-wrapper,
   .return-probabilities-wrapper {
     overflow-x: auto;
     -webkit-overflow-scrolling: touch;
   }
   ```

Double-check that each component doesn't have conflicting overflow rules in parent containers that would prevent scrolling.
  </action>
  <verify>
Build succeeds: `npm run build`
On actual mobile device or emulator:
- Tables scroll smoothly with touch (momentum scrolling works)
- Page doesn't bounce horizontally when reaching table scroll edges
- Scroll indicators appear/disappear correctly during touch scroll
  </verify>
  <done>
All table components have -webkit-overflow-scrolling:touch and overscroll-behavior-x:contain for smooth touch scrolling
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. Mobile DevTools verification at 375px width:
   - All 4 tables show right scroll indicator on initial load
   - Scrolling table updates indicators correctly
   - Left indicator appears when scrolled right
   - Right indicator disappears at scroll end
3. Touch behavior (Chrome DevTools mobile simulation):
   - Tables scroll horizontally with finger drag
   - Momentum scroll works (flick gesture continues after release)
   - No vertical scroll interference
</verification>

<success_criteria>
- yearly-analysis-table.ts has scroll indicators
- sell-yearly-analysis-table.ts has scroll indicators
- performance-table.ts has scroll indicators
- return-probability-table.ts has scroll indicators
- All tables have -webkit-overflow-scrolling: touch
- All tables have overscroll-behavior-x: contain
- Scroll indicators update on scroll events
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-mobile-dashboard-optimization/24-02-SUMMARY.md`
</output>
