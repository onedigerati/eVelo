---
phase: 06-visualizations
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified: [src/charts/probability-cone-chart.ts, src/charts/sbloc-balance-chart.ts, src/charts/index.ts]
autonomous: true

must_haves:
  truths:
    - "User can see probability cone showing net worth over time with percentile bands"
    - "User can see SBLOC balance line chart showing loan trajectory"
    - "Charts are responsive and display without errors"
  artifacts:
    - path: "src/charts/probability-cone-chart.ts"
      provides: "Web Component for probability cone visualization"
      min_lines: 80
      contains: "customElements.define"
    - path: "src/charts/sbloc-balance-chart.ts"
      provides: "Web Component for SBLOC balance line chart"
      min_lines: 60
      contains: "customElements.define"
  key_links:
    - from: "src/charts/probability-cone-chart.ts"
      to: "BaseChart"
      via: "extends BaseChart"
      pattern: "extends BaseChart"
---

<objective>
Create line chart components for probability cone and SBLOC balance visualization.

Purpose: Enable users to visualize net worth trajectories and loan balance over time.
Output: Two Chart.js line chart Web Components (probability-cone-chart, sbloc-balance-chart).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/charts/base-chart.ts
@src/charts/types.ts
@src/simulation/types.ts
@src/sbloc/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create probability cone chart component</name>
  <files>src/charts/probability-cone-chart.ts</files>
  <action>
    Create ProbabilityConeChart Web Component extending BaseChart.

    Requirements (VIZ-01):
    - Shows net worth over time with percentile bands
    - X-axis: years (0 to timeHorizon)
    - Y-axis: portfolio value in dollars
    - Bands: p10-p90 range filled, p25-p75 range filled (darker), p50 median line

    Implementation:
    1. Extend BaseChart
    2. Accept data via property: public data: ProbabilityConeData | null = null
    3. Implement getChartConfig() returning line chart config:
       - type: 'line'
       - Multiple datasets for bands:
         a. P90 upper bound (line, dashed, light green)
         b. P75-P90 fill area (green, 20% opacity)
         c. P75 line (line, green)
         d. P50-P75 fill area (blue, 20% opacity)
         e. P50 median line (line, solid blue, thicker)
         f. P25-P50 fill area (orange, 20% opacity)
         g. P25 line (line, orange)
         h. P10-P25 fill area (red, 20% opacity)
         i. P10 lower bound (line, dashed, light red)

    Chart.js fill property: Use fill: '+1' or fill: '-1' to fill between datasets.
    Alternative simpler approach: Use fill: 'origin' with stacking for band visualization.

    Actually, best approach for percentile bands:
    - Dataset for each percentile line (p10, p25, p50, p75, p90)
    - Use fill: { target: 'origin', above: color } for area under each line
    - Layer them: p90 (bottom), p75, p50, p25, p10 (top) with decreasing opacity

    4. Y-axis formatting: Use Intl.NumberFormat for currency (compact notation for large values)
    5. Tooltip: Show all percentile values for hovered year
    6. Register component: customElements.define('probability-cone-chart', ProbabilityConeChart)

    Responsive: Chart.js handles this with maintainAspectRatio: false and responsive: true.
  </action>
  <verify>npm run build succeeds, component is defined</verify>
  <done>Probability cone chart renders percentile bands correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create SBLOC balance chart component</name>
  <files>src/charts/sbloc-balance-chart.ts</files>
  <action>
    Create SBLOCBalanceChart Web Component extending BaseChart.

    Requirements (VIZ-06):
    - Shows SBLOC loan balance trajectory over time
    - X-axis: years
    - Y-axis: dollar amount
    - Can show multiple lines: loan balance, cumulative withdrawals, interest accrued

    Implementation:
    1. Extend BaseChart
    2. Accept data via property: public data: LineChartData | null = null
    3. Implement getChartConfig() returning line chart config:
       - type: 'line'
       - Support multiple datasets (loan balance is primary, others optional)
       - Colors from DEFAULT_CHART_THEME
       - Loan balance: solid line
       - Cumulative withdrawals: dashed line (if provided)
       - Interest accrued: dotted line (if provided)

    4. Y-axis formatting: Currency with compact notation
    5. Tooltip: Show values for all series at hovered year
    6. Legend: Show dataset labels if multiple series
    7. Register component: customElements.define('sbloc-balance-chart', SBLOCBalanceChart)
  </action>
  <verify>npm run build succeeds, component is defined</verify>
  <done>SBLOC balance chart renders line data correctly</done>
</task>

<task type="auto">
  <name>Task 3: Update module exports</name>
  <files>src/charts/index.ts</files>
  <action>
    Add exports for new chart components:

    export * from './probability-cone-chart';
    export * from './sbloc-balance-chart';
  </action>
  <verify>npm run build succeeds</verify>
  <done>New chart components exportable from charts module</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] tsc --noEmit passes
- [ ] Both chart components registered as custom elements
- [ ] Charts extend BaseChart properly
</verification>

<success_criteria>
- All tasks completed
- Probability cone chart visualizes percentile bands (VIZ-01)
- SBLOC balance chart shows loan trajectory (VIZ-06)
- Components follow project patterns (extend BaseChart, Shadow DOM)
</success_criteria>

<output>
After completion, create `.planning/phases/06-visualizations/06-02-SUMMARY.md`
</output>
