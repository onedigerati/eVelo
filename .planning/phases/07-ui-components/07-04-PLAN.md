---
phase: 07-ui-components
plan: 04
type: execute
wave: 2
depends_on: ["07-02"]
files_modified:
  - src/components/ui/main-layout.ts
  - src/components/ui/help-section.ts
  - src/components/ui/index.ts
  - src/style.css
autonomous: false

must_haves:
  truths:
    - "Main layout shows sidebar + content area in responsive grid"
    - "Sidebar collapse updates layout automatically"
    - "Layout adapts to mobile with sidebar as overlay"
    - "Help sections expand/collapse with useful information"
  artifacts:
    - path: "src/components/ui/main-layout.ts"
      provides: "CSS Grid layout with sidebar + main content"
      min_lines: 80
    - path: "src/components/ui/help-section.ts"
      provides: "Expandable help/guide content"
      min_lines: 40
  key_links:
    - from: "sidebar-panel toggle event"
      to: "main-layout data-sidebar-collapsed"
      via: "event listener updates attribute"
    - from: "main-layout CSS"
      to: "grid-template-columns"
      via: "attribute selector changes column sizes"
---

<objective>
Create main layout orchestrator and responsive mobile adjustments.

Purpose: Wire all UI components together in a responsive grid layout that adapts to screen size and sidebar state.
Output: main-layout component, help-section component, and responsive CSS.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-ui-components/07-RESEARCH.md
@src/components/base-component.ts
@.planning/phases/07-ui-components/07-02-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create main-layout component</name>
  <files>src/components/ui/main-layout.ts</files>
  <action>
Create main layout orchestrator component extending BaseComponent.

This component manages the overall page layout: sidebar on left, main content on right.

Attributes (observedAttributes):
- sidebar-collapsed: boolean (presence = sidebar is collapsed)
- sidebar-open: boolean (mobile only - presence = sidebar overlay is visible)

Template:
```html
<div class="layout">
  <div class="sidebar-area">
    <slot name="sidebar"></slot>
  </div>
  <div class="main-area">
    <header class="main-header">
      <button class="mobile-menu-btn" aria-label="Open menu">☰</button>
      <slot name="header"></slot>
    </header>
    <main class="main-content">
      <slot></slot>
    </main>
  </div>
  <div class="sidebar-backdrop" aria-hidden="true"></div>
</div>
```

Styles:
```css
:host {
  display: block;
  height: 100vh;
}

.layout {
  display: grid;
  grid-template-columns: var(--sidebar-width) 1fr;
  height: 100%;
}

:host([sidebar-collapsed]) .layout {
  grid-template-columns: var(--sidebar-collapsed-width) 1fr;
}

.sidebar-area {
  grid-column: 1;
  overflow-y: auto;
  background: var(--surface-secondary);
  border-right: 1px solid var(--border-color);
}

.main-area {
  grid-column: 2;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.main-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-md) var(--spacing-lg);
  border-bottom: 1px solid var(--border-color);
  background: var(--surface-primary);
}

.mobile-menu-btn {
  display: none;
  background: transparent;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  padding: var(--spacing-xs);
}

.main-content {
  flex: 1;
  overflow-y: auto;
  padding: var(--spacing-lg);
}

.sidebar-backdrop {
  display: none;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .layout {
    grid-template-columns: 1fr;
  }

  .sidebar-area {
    position: fixed;
    left: 0;
    top: 0;
    height: 100%;
    width: var(--sidebar-width);
    z-index: 100;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }

  :host([sidebar-open]) .sidebar-area {
    transform: translateX(0);
  }

  :host([sidebar-open]) .sidebar-backdrop {
    display: block;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 99;
  }

  .mobile-menu-btn {
    display: block;
  }
}
```

afterRender:
1. Listen for 'toggle' event from sidebar-panel, update sidebar-collapsed attribute:
```typescript
this.addEventListener('toggle', ((e: CustomEvent) => {
  if (e.detail.collapsed) {
    this.setAttribute('sidebar-collapsed', '');
  } else {
    this.removeAttribute('sidebar-collapsed');
  }
}) as EventListener);
```

2. Mobile menu button opens sidebar overlay:
```typescript
this.$('.mobile-menu-btn')?.addEventListener('click', () => {
  this.setAttribute('sidebar-open', '');
});
```

3. Backdrop click closes sidebar overlay:
```typescript
this.$('.sidebar-backdrop')?.addEventListener('click', () => {
  this.removeAttribute('sidebar-open');
});
```
  </action>
  <verify>npm run build succeeds, layout grid responds to sidebar-collapsed attribute</verify>
  <done>main-layout creates responsive grid that adapts to sidebar state and mobile screens</done>
</task>

<task type="auto">
  <name>Task 2: Create help-section component</name>
  <files>src/components/ui/help-section.ts</files>
  <action>
Create expandable help/guide component extending BaseComponent.

This wraps details/summary with additional styling for help content.

Attributes:
- title: string (help section heading)
- open: boolean (presence = initially open)
- icon: string (optional, defaults to "❓")

Template:
```html
<details ${open ? 'open' : ''} class="help-details">
  <summary class="help-summary">
    <span class="help-icon">${icon || '❓'}</span>
    <span class="help-title">${title}</span>
    <span class="chevron">▼</span>
  </summary>
  <div class="help-content">
    <slot></slot>
  </div>
</details>
```

Styles:
```css
.help-details {
  background: var(--surface-secondary);
  border-radius: var(--border-radius-md);
  margin-bottom: var(--spacing-sm);
}

.help-summary {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  cursor: pointer;
  user-select: none;
  list-style: none;
}

.help-summary::-webkit-details-marker {
  display: none;
}

.help-icon {
  font-size: 1.2em;
}

.help-title {
  flex: 1;
  font-weight: 500;
  color: var(--text-primary);
}

.chevron {
  transition: transform 0.2s ease;
  color: var(--text-secondary);
}

.help-details[open] .chevron {
  transform: rotate(180deg);
}

.help-content {
  padding: 0 var(--spacing-md) var(--spacing-md);
  color: var(--text-secondary);
  font-size: var(--font-size-sm);
  line-height: 1.6;
}

.help-content p {
  margin: 0 0 var(--spacing-sm);
}

.help-content p:last-child {
  margin-bottom: 0;
}
```

No additional JS needed - native details/summary handles expand/collapse.
  </action>
  <verify>npm run build succeeds, help-section expands/collapses</verify>
  <done>help-section provides styled expandable help content using native details/summary</done>
</task>

<task type="auto">
  <name>Task 3: Update style.css and finalize UI module</name>
  <files>src/style.css, src/components/ui/index.ts</files>
  <action>
**style.css updates:**
Import tokens and add global resets:

```css
@import './styles/tokens.css';

*,
*::before,
*::after {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  font-family: var(--font-family);
  font-size: var(--font-size-md);
  color: var(--text-primary);
  background: var(--surface-primary);
  height: 100%;
}

#app {
  height: 100%;
}

/* Utility classes */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}
```

**index.ts final exports:**
Ensure all components are exported and registered:

```typescript
// Components
export { RangeSlider } from './range-slider';
export { NumberInput } from './number-input';
export { SelectInput } from './select-input';
export { SidebarPanel } from './sidebar-panel';
export { ParamSection } from './param-section';
export { AssetSelector } from './asset-selector';
export { WeightEditor } from './weight-editor';
export { ProgressIndicator } from './progress-indicator';
export { ToastNotification } from './toast-notification';
export { ToastContainer } from './toast-container';
export { MainLayout } from './main-layout';
export { HelpSection } from './help-section';

// Register all custom elements
import { RangeSlider } from './range-slider';
import { NumberInput } from './number-input';
import { SelectInput } from './select-input';
import { SidebarPanel } from './sidebar-panel';
import { ParamSection } from './param-section';
import { AssetSelector } from './asset-selector';
import { WeightEditor } from './weight-editor';
import { ProgressIndicator } from './progress-indicator';
import { ToastNotification } from './toast-notification';
import { ToastContainer } from './toast-container';
import { MainLayout } from './main-layout';
import { HelpSection } from './help-section';

customElements.define('range-slider', RangeSlider);
customElements.define('number-input', NumberInput);
customElements.define('select-input', SelectInput);
customElements.define('sidebar-panel', SidebarPanel);
customElements.define('param-section', ParamSection);
customElements.define('asset-selector', AssetSelector);
customElements.define('weight-editor', WeightEditor);
customElements.define('progress-indicator', ProgressIndicator);
customElements.define('toast-notification', ToastNotification);
customElements.define('toast-container', ToastContainer);
customElements.define('main-layout', MainLayout);
customElements.define('help-section', HelpSection);
```
  </action>
  <verify>npm run build succeeds, all components registered</verify>
  <done>style.css imports tokens, all UI components exported and registered</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete responsive UI component system with sidebar, inputs, progress, toasts, and layout</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open browser at localhost:5173
    3. Create a simple test page with the components (or check dev server output)

    Test the following:
    - Sidebar collapse: Click toggle button, sidebar should collapse smoothly
    - Mobile: Resize browser to <768px, sidebar becomes overlay with hamburger menu
    - Input components: range-slider drags, number-input accepts values
    - Toast: (Would need to call show() - visual check that component exists)
    - Progress: (Would need to set value - visual check that component exists)
    - Help sections: Click to expand/collapse

    Note: Full integration will happen in Phase 8. This verifies components exist and basic interactions work.
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] tokens.css imported in style.css
- [ ] main-layout responds to sidebar collapse
- [ ] Mobile breakpoint hides sidebar, shows hamburger
- [ ] All 12 UI components exported from index.ts
- [ ] All 12 custom elements registered
- [ ] Human verification passed
</verification>

<success_criteria>

- All tasks completed
- Responsive layout works on desktop and mobile
- Sidebar state correctly propagates to layout
- All components build without TypeScript errors
- Human approved visual verification
</success_criteria>

<output>
After completion, create `.planning/phases/07-ui-components/07-04-SUMMARY.md`
</output>
