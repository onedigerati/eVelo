---
phase: 07-ui-components
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/progress-indicator.ts
  - src/components/ui/toast-container.ts
  - src/components/ui/toast-notification.ts
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "Progress indicator shows percentage during simulation"
    - "Progress indicator can show indeterminate state while loading"
    - "Toast notifications appear and auto-dismiss after duration"
    - "Toasts are accessible via ARIA live region"
  artifacts:
    - path: "src/components/ui/progress-indicator.ts"
      provides: "Simulation progress display with determinate/indeterminate modes"
      min_lines: 60
    - path: "src/components/ui/toast-container.ts"
      provides: "Fixed position container managing toast lifecycle"
      min_lines: 50
    - path: "src/components/ui/toast-notification.ts"
      provides: "Individual toast element with type-based styling"
      min_lines: 60
  key_links:
    - from: "simulation worker"
      to: "progress-indicator"
      via: "value attribute updates"
    - from: "toast-container.show()"
      to: "toast-notification"
      via: "creates and appends toast element"
    - from: "toast-notification close-btn"
      to: "DOM"
      via: "removes self from parent"
---

<objective>
Create progress indicator and toast notification system.

Purpose: Provide visual feedback during long-running simulations and for user actions.
Output: progress-indicator, toast-container, and toast-notification components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-ui-components/07-RESEARCH.md
@src/components/base-component.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create progress-indicator component</name>
  <files>src/components/ui/progress-indicator.ts</files>
  <action>
Create progress indicator component extending BaseComponent.

Attributes (observedAttributes):
- value: number 0-100 (percentage complete)
- indeterminate: boolean (presence = indeterminate mode)
- label: string (optional, shown above progress bar)

Template:
```html
<div class="progress-wrapper">
  ${label ? `<span class="progress-label">${label}</span>` : ''}
  <div class="progress-container"
       role="progressbar"
       aria-valuenow="${indeterminate ? '' : value}"
       aria-valuemin="0"
       aria-valuemax="100"
       ${indeterminate ? 'aria-busy="true"' : ''}>
    <div class="progress-bar" style="width: ${indeterminate ? '30%' : value + '%'}"></div>
    <span class="progress-text">${indeterminate ? 'Processing...' : value + '%'}</span>
  </div>
</div>
```

Styles:
- progress-wrapper: flex column, gap
- progress-label: font-size sm, text secondary
- progress-container: position relative, height 24px, background surface-tertiary, border-radius-lg, overflow hidden
- progress-bar: height 100%, background color-primary, transition width 0.2s ease
- progress-text: position absolute, inset 0, flex center, font-size 12px, font-weight 500

Indeterminate animation:
```css
:host([indeterminate]) .progress-bar {
  width: 30%;
  animation: indeterminate 1.5s infinite linear;
}

@keyframes indeterminate {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(400%); }
}
```

Value property:
Add getter/setter that clamps to 0-100 and updates attribute.

```typescript
set value(val: number) {
  const clamped = Math.min(100, Math.max(0, val));
  this.setAttribute('value', String(clamped));
}

get value(): number {
  return parseInt(this.getAttribute('value') || '0', 10);
}
```

No events needed - parent updates value attribute directly.
  </action>
  <verify>npm run build succeeds, progress bar fills correctly, indeterminate animates</verify>
  <done>progress-indicator shows percentage or indeterminate state with proper ARIA attributes</done>
</task>

<task type="auto">
  <name>Task 2: Create toast-notification component</name>
  <files>src/components/ui/toast-notification.ts</files>
  <action>
Create individual toast element extending BaseComponent.

Attributes (observedAttributes):
- type: 'success' | 'error' | 'info' | 'warning' (default 'info')

Template:
```html
<output class="toast">
  <span class="icon">${this.getIcon()}</span>
  <span class="message"><slot></slot></span>
  <button class="close" aria-label="Dismiss">&times;</button>
</output>
```

getIcon() method:
- success: ✓
- error: ✕
- warning: ⚠
- info: ℹ

Styles:
```css
.toast {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: var(--toast-bg, #333);
  color: var(--toast-color, #fff);
  border-radius: var(--border-radius-md);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  pointer-events: auto;
  animation: slide-in 0.3s ease;
  min-width: 200px;
  max-width: 400px;
}

:host([type="success"]) .toast {
  --toast-bg: var(--color-success);
}

:host([type="error"]) .toast {
  --toast-bg: var(--color-error);
}

:host([type="warning"]) .toast {
  --toast-bg: var(--color-warning);
}

:host([type="info"]) .toast {
  --toast-bg: var(--color-primary);
}

.icon {
  font-size: 1.2em;
}

.message {
  flex: 1;
}

.close {
  background: transparent;
  border: none;
  color: inherit;
  font-size: 1.2em;
  cursor: pointer;
  padding: 0 4px;
  opacity: 0.7;
}

.close:hover {
  opacity: 1;
}

@keyframes slide-in {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

:host(.removing) .toast {
  animation: fade-out 0.3s ease forwards;
}

@keyframes fade-out {
  to { opacity: 0; transform: translateY(10px); }
}
```

afterRender:
- Attach click handler to close button that calls this.remove()
  </action>
  <verify>npm run build succeeds, toast renders with correct type styling</verify>
  <done>toast-notification displays with type-specific colors and close button</done>
</task>

<task type="auto">
  <name>Task 3: Create toast-container component</name>
  <files>src/components/ui/toast-container.ts, src/components/ui/index.ts</files>
  <action>
**toast-container.ts:**
Create toast manager component extending BaseComponent.

This is a singleton container that manages toast lifecycle. Only one should exist in the app.

Template:
```html
<div id="toast-container" role="status" aria-live="polite" aria-atomic="false">
  <!-- Toasts inserted here -->
</div>
```

Styles:
```css
#toast-container {
  position: fixed;
  bottom: 24px;
  right: 24px;
  display: flex;
  flex-direction: column-reverse;
  gap: 8px;
  z-index: 1000;
  pointer-events: none;
}

/* Mobile: center toasts at bottom */
@media (max-width: 480px) {
  #toast-container {
    left: 16px;
    right: 16px;
  }
}
```

Public methods:

```typescript
/**
 * Show a toast notification.
 * @param message - Text to display
 * @param type - 'success' | 'error' | 'info' | 'warning'
 * @param duration - Auto-dismiss after ms (default 5000, 0 = no auto-dismiss)
 */
public show(
  message: string,
  type: 'success' | 'error' | 'info' | 'warning' = 'info',
  duration = 5000
): void {
  const container = this.$('#toast-container');
  if (!container) return;

  const toast = document.createElement('toast-notification');
  toast.setAttribute('type', type);
  toast.textContent = message;
  container.appendChild(toast);

  // Limit to 3 visible toasts (remove oldest)
  const toasts = container.querySelectorAll('toast-notification');
  if (toasts.length > 3) {
    toasts[0].remove();
  }

  // Auto-dismiss
  if (duration > 0) {
    setTimeout(() => {
      toast.classList.add('removing');
      setTimeout(() => toast.remove(), 300);
    }, duration);
  }
}

/**
 * Convenience methods.
 */
public success(message: string, duration?: number): void {
  this.show(message, 'success', duration);
}

public error(message: string, duration?: number): void {
  this.show(message, 'error', duration);
}

public info(message: string, duration?: number): void {
  this.show(message, 'info', duration);
}

public warning(message: string, duration?: number): void {
  this.show(message, 'warning', duration);
}
```

**index.ts updates:**
Add exports and registrations for progress-indicator, toast-notification, toast-container.
  </action>
  <verify>npm run build succeeds, toast-container.show() creates toast elements</verify>
  <done>toast-container manages toast lifecycle with auto-dismiss, max visible limit, and convenience methods</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] progress-indicator shows percentage correctly
- [ ] progress-indicator indeterminate animation works
- [ ] toast-notification renders with type-based colors
- [ ] toast-container.show() creates and auto-dismisses toasts
- [ ] ARIA attributes present for accessibility
</verification>

<success_criteria>

- All tasks completed
- Progress indicator handles 0-100% and indeterminate state
- Toast system shows feedback with auto-dismiss
- Proper accessibility attributes on all components
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-ui-components/07-03-SUMMARY.md`
</output>
