---
phase: 07-ui-components
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/sidebar-panel.ts
  - src/components/ui/param-section.ts
  - src/components/ui/asset-selector.ts
  - src/components/ui/weight-editor.ts
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "Sidebar can be collapsed/expanded via toggle button"
    - "Parameter sections expand/collapse using native details/summary"
    - "User can search/filter assets by typing in search box"
    - "User can balance weights equally or clear all weights"
  artifacts:
    - path: "src/components/ui/sidebar-panel.ts"
      provides: "Collapsible sidebar container"
      min_lines: 60
    - path: "src/components/ui/param-section.ts"
      provides: "Collapsible parameter group using details/summary"
      min_lines: 40
    - path: "src/components/ui/asset-selector.ts"
      provides: "Asset search/filter/select component"
      min_lines: 80
    - path: "src/components/ui/weight-editor.ts"
      provides: "Weight distribution with balance/clear"
      min_lines: 80
  key_links:
    - from: "sidebar-panel toggle-btn"
      to: "sidebar-panel collapsed attribute"
      via: "click handler toggles attribute"
    - from: "asset-selector search-input"
      to: "asset-selector asset-list"
      via: "input event filters displayed items"
    - from: "weight-editor balance-btn"
      to: "child weight inputs"
      via: "weights-balanced event with equal values"
---

<objective>
Create sidebar layout and portfolio configuration components.

Purpose: Enable users to configure portfolio parameters in an organized, collapsible sidebar with asset selection and weight management.
Output: sidebar-panel, param-section, asset-selector, and weight-editor components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-ui-components/07-RESEARCH.md
@src/components/base-component.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sidebar-panel and param-section components</name>
  <files>src/components/ui/sidebar-panel.ts, src/components/ui/param-section.ts</files>
  <action>
**sidebar-panel.ts:**
Create collapsible sidebar container extending BaseComponent.

Attributes (observedAttributes):
- collapsed: boolean (presence = collapsed)

Template:
```html
<aside class="sidebar">
  <button class="toggle-btn" aria-label="Toggle sidebar" aria-expanded="true">
    <span class="icon">☰</span>
  </button>
  <div class="sidebar-content">
    <slot></slot>
  </div>
</aside>
```

Styles:
- Use CSS Grid for layout: grid-template-rows: auto 1fr
- Width: var(--sidebar-width) normally, var(--sidebar-collapsed-width) when collapsed
- Transition: width 0.3s ease (animate via transform translateX instead of width for smoothness)
- When collapsed: hide sidebar-content, show only toggle button
- Background: var(--surface-secondary)
- Border-right: 1px solid var(--border-color)
- Toggle button: transparent bg, pointer cursor, rotates icon on collapse

Events:
- click on toggle-btn: toggle collapsed attribute
- Dispatch 'toggle' CustomEvent with { bubbles: true, composed: true, detail: { collapsed: boolean } }

Accessibility:
- Update aria-expanded on toggle button when state changes

**param-section.ts:**
Create collapsible parameter group using native details/summary.

Attributes:
- title: string (section heading)
- open: boolean (presence = initially open)

Template:
```html
<details ${open ? 'open' : ''}>
  <summary>
    <span class="section-title">${title}</span>
    <span class="chevron">▼</span>
  </summary>
  <div class="section-content">
    <slot></slot>
  </div>
</details>
```

Styles:
- details: border-bottom: 1px solid var(--border-color)
- summary: flex row, justify-content: space-between, padding: var(--spacing-md), cursor: pointer
- Hide default marker: summary::-webkit-details-marker { display: none }
- Chevron rotates 180deg when details[open]
- section-content: padding: 0 var(--spacing-md) var(--spacing-md)

No additional JS needed - native details/summary handles expand/collapse.
  </action>
  <verify>npm run build succeeds, sidebar collapses on toggle click</verify>
  <done>sidebar-panel toggles collapsed state and emits events; param-section expands/collapses natively</done>
</task>

<task type="auto">
  <name>Task 2: Create asset-selector component</name>
  <files>src/components/ui/asset-selector.ts</files>
  <action>
Create asset search/filter/select component extending BaseComponent.

Attributes:
- assets: JSON string array of asset tickers (e.g., '["SPY","QQQ","VTI"]')
- selected: JSON string array of selected assets
- max-selection: number (optional, limits selection count, default 5)

Template:
```html
<div class="asset-selector">
  <input type="search"
         placeholder="Search assets..."
         class="search-input"
         aria-label="Search available assets" />
  <ul class="asset-list" role="listbox" aria-label="Available assets">
    <!-- Populated dynamically -->
  </ul>
  <div class="selected-count">
    <span class="count">0</span>/<span class="max">5</span> selected
  </div>
</div>
```

Styles:
- search-input: full width, styled with design tokens
- asset-list: max-height: 200px, overflow-y: auto, no bullets
- asset-item: padding, hover highlight, cursor pointer
- asset-item[aria-selected="true"]: primary color background

Internal state:
- filteredAssets: string[] (filtered by search)
- selectedAssets: Set<string>

Methods:
- filterAssets(query: string): Filter assets array by lowercase includes
- renderAssetList(): Rebuild list items from filteredAssets
- toggleAsset(asset: string): Add/remove from selectedAssets, respect max-selection

Events:
- input on search-input: call filterAssets
- click on asset-item: call toggleAsset
- Dispatch 'selection-change' with { bubbles: true, composed: true, detail: { selected: string[] } }

Accessibility:
- role="option" on list items
- aria-selected reflects selection state
  </action>
  <verify>npm run build succeeds, search filters list, selection toggles</verify>
  <done>asset-selector filters by search query, tracks selection with max limit, emits selection-change events</done>
</task>

<task type="auto">
  <name>Task 3: Create weight-editor component</name>
  <files>src/components/ui/weight-editor.ts, src/components/ui/index.ts</files>
  <action>
**weight-editor.ts:**
Create weight distribution component extending BaseComponent.

Attributes:
- assets: JSON string array of assets to show weights for

Template:
```html
<div class="weight-editor">
  <div class="weights-list">
    <!-- Weight rows inserted dynamically -->
  </div>
  <div class="controls">
    <button class="balance-btn">Balance Equally</button>
    <button class="clear-btn">Clear All</button>
  </div>
  <div class="total">
    Total: <span class="total-value">0</span>%
    <span class="validation"></span>
  </div>
</div>
```

Internal state:
- weights: Map<string, number>

Weight row template (generated per asset):
```html
<div class="weight-row" data-asset="${asset}">
  <span class="asset-name">${asset}</span>
  <input type="number" min="0" max="100" step="0.1" value="0" class="weight-input" />
  <span class="percent">%</span>
</div>
```

Styles:
- weight-row: flex row, align-items center, gap
- weight-input: width 60-80px, text-align right
- controls: flex row, gap, margin-top
- balance-btn, clear-btn: styled buttons with design tokens
- total: margin-top, font-weight bold
- validation.invalid: color error, validation.valid: color success

Methods:
- renderWeights(): Rebuild weight rows from assets attribute
- updateTotal(): Sum weights, update display, show validation (must equal 100%)
- balanceWeights(): Set each weight to 100/count, dispatch event
- clearWeights(): Set all to 0, dispatch event

Events:
- input on weight-input: update weights Map, call updateTotal
- click on balance-btn: call balanceWeights
- click on clear-btn: call clearWeights
- Dispatch 'weights-change' with { bubbles: true, composed: true, detail: { weights: Record<string, number>, total: number, valid: boolean } }

**index.ts updates:**
Add exports and registrations for sidebar-panel, param-section, asset-selector, weight-editor.
  </action>
  <verify>npm run build succeeds, weights update total, balance/clear work</verify>
  <done>weight-editor tracks weights per asset, validates total=100%, balance/clear buttons work</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] sidebar-panel toggles collapsed attribute on button click
- [ ] param-section uses native details/summary (no custom JS for toggle)
- [ ] asset-selector filters list on search input
- [ ] weight-editor total updates on weight changes
- [ ] All events use bubbles: true, composed: true
</verification>

<success_criteria>

- All tasks completed
- Sidebar collapse/expand works with smooth transition
- Asset selector search filters correctly
- Weight editor validates total equals 100%
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-ui-components/07-02-SUMMARY.md`
</output>
