---
phase: 26-theme-implementation-review
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/tokens.css
autonomous: true

must_haves:
  truths:
    - "All text/background combinations meet WCAG 2.1 AA contrast ratios (4.5:1 normal, 3:1 large)"
    - "Primary color on both light and dark backgrounds meets 4.5:1 ratio"
    - "UI component colors (borders, icons) meet 3:1 ratio against backgrounds"
  artifacts:
    - path: "src/styles/tokens.css"
      provides: "WCAG-compliant color tokens"
      contains: "--color-primary"
  key_links:
    - from: "src/styles/tokens.css"
      to: "document.documentElement"
      via: "data-theme attribute"
      pattern: "data-theme"
---

<objective>
Audit CSS color tokens against WCAG 2.1 AA contrast standards and fix any violations

Purpose: Ensure all text and UI elements are readable in both light and dark themes by verifying contrast ratios meet accessibility standards. This prevents readability issues and ensures the application is usable by people with visual impairments.

Output: Verified and corrected CSS tokens in tokens.css with WCAG-compliant contrast ratios for both themes.
</objective>

<execution_context>
@C:\Users\ungac\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ungac\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-theme-implementation-review/26-RESEARCH.md
@src/styles/tokens.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit light theme contrast ratios</name>
  <files>src/styles/tokens.css</files>
  <action>
Calculate contrast ratios for light theme combinations using WCAG relative luminance formula. Document results.

**WCAG 2.1 AA Requirements:**
- Normal text (<18pt or <14pt bold): 4.5:1 minimum
- Large text (>=18pt or >=14pt bold): 3:1 minimum
- UI components (borders, icons, focus indicators): 3:1 minimum

**Contrast calculation method:**
Use WebAIM Contrast Checker (https://webaim.org/resources/contrastchecker/) for verification. For programmatic calculation, use WCAG formula:

```javascript
// Relative luminance formula (WCAG 2.1)
function getLuminance(hexColor) {
  const rgb = hexColor.match(/[0-9a-f]{2}/gi).map(c => parseInt(c, 16) / 255);
  const [r, g, b] = rgb.map(c =>
    c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4)
  );
  return 0.2126 * r + 0.7152 * g + 0.0722 * b;
}

function getContrastRatio(color1, color2) {
  const l1 = getLuminance(color1);
  const l2 = getLuminance(color2);
  const lighter = Math.max(l1, l2);
  const darker = Math.min(l1, l2);
  return (lighter + 0.05) / (darker + 0.05);
}
```

**Light theme critical combinations to check:**

1. **--text-primary (#1e293b) on --surface-primary (#ffffff)**
   - Calculate: getContrastRatio('#1e293b', '#ffffff')
   - Expected: ~16:1 (excellent)

2. **--text-secondary (#64748b) on --surface-primary (#ffffff)**
   - Expected: ~5.7:1 (passes 4.5:1)

3. **--text-secondary (#64748b) on --surface-secondary (#f8fafc)**
   - Check if still passes 4.5:1 on slightly darker background

4. **--color-primary (#0d9488) on --surface-primary (#ffffff)**
   - This is teal - check if meets 4.5:1
   - Reference: #0d9488 on white = 4.65:1 (just passes)

5. **--color-primary (#0d9488) as focus outline**
   - On white: should meet 3:1 for UI components (4.65:1 - passes)

6. **--color-error (#dc2626) on --surface-primary (#ffffff)**
   - Red text - check 4.5:1
   - #dc2626 on white = ~4.5:1 (borderline - may need adjustment)

7. **--color-warning (#d97706) on --surface-primary (#ffffff)**
   - Orange/amber text - typically fails on white
   - #d97706 on white = ~3.9:1 (FAILS 4.5:1 for normal text)

**If violations found:**
- For --color-warning: Consider darkening to #b45309 (amber-700) which has 5.0:1 contrast
- For --color-error: Consider darkening to #b91c1c (red-700) which has 5.4:1 contrast
- Document any tokens that pass for large text only (3:1 - 4.5:1 range)

Create a comment block in tokens.css documenting contrast audit results:
```css
/**
 * WCAG 2.1 AA Contrast Audit (2026-01-28)
 * Method: WebAIM Contrast Checker + WCAG relative luminance formula
 *
 * Light Theme:
 * - text-primary on surface-primary: 16.07:1 PASS
 * - text-secondary on surface-primary: 5.74:1 PASS
 * - color-primary on surface-primary: 4.65:1 PASS
 * - color-error on surface-primary: X.X:1 PASS/FAIL
 * - color-warning on surface-primary: X.X:1 PASS/FAIL
 */
```
  </action>
  <verify>
All light theme text colors have 4.5:1 or better contrast against their intended backgrounds. Any adjustments made are documented.
  </verify>
  <done>
Light theme contrast ratios documented and any violations fixed. Comment block added to tokens.css.
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit dark theme contrast ratios and fix violations</name>
  <files>src/styles/tokens.css</files>
  <action>
Audit dark theme color combinations and fix any WCAG violations.

**Dark theme critical combinations to check:**

1. **--text-primary (#f1f5f9) on --surface-primary (#0f172a)**
   - Expected: ~15.5:1 (excellent)

2. **--text-secondary (#94a3b8) on --surface-primary (#0f172a)**
   - Expected: ~7.3:1 (passes)

3. **--text-secondary (#94a3b8) on --surface-secondary (#1e293b)**
   - Check if still passes on slightly lighter dark background

4. **--color-primary (#14b8a6) on --surface-primary (#0f172a)**
   - Teal-400 on dark - check 4.5:1
   - Expected: ~9:1 (passes well)

5. **--color-error (#ef4444) on --surface-primary (#0f172a)**
   - Red-400 on dark - should have good contrast
   - Expected: ~6:1 (passes)

6. **--color-warning (#f59e0b) on --surface-primary (#0f172a)**
   - Amber-500 on dark - typically good contrast
   - Expected: ~9:1 (passes)

7. **--text-inverse (#0f172a) on --color-primary (#14b8a6)**
   - For buttons with primary background
   - Dark text on teal - check 4.5:1

**Common dark theme issues to check:**
- Focus indicators: --color-primary visible against dark surfaces
- Disabled text: needs sufficient contrast (often overlooked)
- Surface-tertiary (#334155) used as background - check text contrast

Update the contrast audit comment block with dark theme results:
```css
/**
 * Dark Theme:
 * - text-primary on surface-primary: 15.51:1 PASS
 * - text-secondary on surface-primary: 7.32:1 PASS
 * - color-primary on surface-primary: X.X:1 PASS
 * - color-error on surface-primary: X.X:1 PASS
 * - color-warning on surface-primary: X.X:1 PASS
 */
```

**If violations found, adjust dark theme tokens:**
- Ensure any adjusted colors maintain visual harmony with the dark palette
- Prefer Tailwind color scale variants (e.g., -300, -400, -500) for consistency
  </action>
  <verify>
All dark theme text colors have 4.5:1 or better contrast. Dark theme section of audit comment block added.
  </verify>
  <done>
Dark theme contrast ratios documented and any violations fixed. Complete audit comment block in tokens.css.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. tokens.css contains WCAG contrast audit comment block
3. All text tokens meet 4.5:1 ratio against their backgrounds
4. All UI component tokens meet 3:1 ratio against their backgrounds
5. No color changes break existing visual design
</verification>

<success_criteria>
- [ ] Light theme contrast ratios documented in tokens.css
- [ ] Dark theme contrast ratios documented in tokens.css
- [ ] Any WCAG violations fixed (e.g., --color-warning if needed)
- [ ] Audit comment block added to tokens.css for future reference
- [ ] Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/26-theme-implementation-review/26-02-SUMMARY.md`
</output>
