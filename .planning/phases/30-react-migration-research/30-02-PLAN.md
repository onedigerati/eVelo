---
phase: 30-react-migration-research
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/30-react-migration-research/30-MIGRATION-STRATEGY.md
  - .planning/phases/30-react-migration-research/30-RISK-ASSESSMENT.md
autonomous: true

must_haves:
  truths:
    - "Shadow DOM migration strategy is defined with CSS isolation approach"
    - "Chart.js integration path is documented (react-chartjs-2 vs custom hooks)"
    - "Web Worker compatibility with React is verified"
    - "Testing migration path is documented"
    - "Risk assessment is complete with mitigation strategies"
  artifacts:
    - path: ".planning/phases/30-react-migration-research/30-MIGRATION-STRATEGY.md"
      provides: "Technical migration strategy for each subsystem"
      min_lines: 150
    - path: ".planning/phases/30-react-migration-research/30-RISK-ASSESSMENT.md"
      provides: "Risk matrix with mitigation strategies"
      min_lines: 100
  key_links:
    - from: "30-MIGRATION-STRATEGY.md"
      to: "30-RESEARCH.md"
      via: "Implementation patterns"
      pattern: "Pattern"
---

<objective>
Create migration strategy and risk assessment documents for the React migration research.

Purpose: Fulfills success criteria #3-7 from the phase requirements - Shadow DOM strategy, Chart.js integration, Web Worker compatibility, testing migration, and risk assessment.

Output: Two documentation files - technical migration strategy and risk assessment matrix.
</objective>

<execution_context>
@C:\Users\ungac\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ungac\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-react-migration-research/30-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Migration Strategy Document</name>
  <files>.planning/phases/30-react-migration-research/30-MIGRATION-STRATEGY.md</files>
  <action>
    Create a comprehensive migration strategy document covering each technical subsystem:

    **1. Shadow DOM to CSS Isolation Strategy (Success Criteria #3)**
    - Current: Shadow DOM encapsulation in BaseComponent
    - Options: CSS Modules, styled-components, Tailwind CSS
    - Recommendation: CSS Modules (build-time scoping, no runtime overhead)
    - Migration approach: Create .module.css file per component
    - Code examples: Before (Shadow DOM styles) vs After (CSS Modules)
    - Pitfalls: Global styles bleeding, specificity changes

    **2. Chart.js Integration (Success Criteria #4)**
    - Current: BaseChart class, 11 chart components extending it
    - Options: react-chartjs-2 wrapper vs custom useChart hook
    - Recommendation: Custom hooks for control, react-chartjs-2 for speed
    - Code examples for each approach
    - Theme integration: How chart colors update on theme change
    - Responsive behavior preservation

    **3. Web Worker Compatibility (Success Criteria #5)**
    - Current: Comlink + Web Worker for Monte Carlo simulation
    - Verification: Comlink works identically with React (no changes needed)
    - Integration pattern: useSimulationWorker custom hook
    - Code example from 30-RESEARCH.md
    - State management: Zustand store for simulation results
    - Progress updates: How to wire progress callback to React state

    **4. Testing Migration (Success Criteria #6)**
    - Current: agent-browser E2E tests + Vitest unit tests
    - E2E migration: Playwright supports React (minimal changes)
    - Unit test migration: Vitest + React Testing Library
    - Component testing: render() + fireEvent patterns
    - Snapshot testing considerations
    - Code examples for each test type

    **5. IndexedDB/Dexie Migration**
    - Current: Direct Dexie.js access in services
    - Migration: dexie-react-hooks (useLiveQuery)
    - Code examples: Current pattern vs React hook pattern
    - Caching considerations with TanStack Query (if needed)

    **6. Incremental vs Big-Bang Migration**
    - Strangler pattern explanation
    - Web Component wrapper approach (from research)
    - Recommended migration sequence:
      1. Leaf components (inputs, buttons) - Week 1-2
      2. Chart components - Week 3-4
      3. Composite components - Week 5-6
      4. Dashboard/layout components - Week 7-8
      5. App root and routing - Week 9-10
      6. Testing and polish - Week 11-12

    Format as markdown with code snippets, comparison tables, and clear recommendations.
  </action>
  <verify>
    - File has dedicated section for Shadow DOM migration
    - File has dedicated section for Chart.js integration
    - File has dedicated section for Web Workers
    - File has dedicated section for testing migration
    - Each section has code examples (before/after)
    - File includes incremental migration timeline
  </verify>
  <done>
    30-MIGRATION-STRATEGY.md exists with:
    - Shadow DOM to CSS Modules strategy defined
    - Chart.js integration path (react-chartjs-2 or custom hooks)
    - Web Worker + Comlink compatibility verified
    - Testing migration path (agent-browser to Playwright, Vitest unchanged)
    - Incremental migration sequence with timeline
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Risk Assessment Document</name>
  <files>.planning/phases/30-react-migration-research/30-RISK-ASSESSMENT.md</files>
  <action>
    Create a formal risk assessment matrix with mitigation strategies:

    **Risk Matrix Format:**
    | Risk | Likelihood | Impact | Score | Mitigation | Contingency |
    |------|------------|--------|-------|------------|-------------|

    **Categories of Risks:**

    1. **Technical Risks**
       - CSS isolation loss (styles bleed between components)
       - Event system mismatch (CustomEvents don't propagate)
       - Property vs attribute confusion (objects become "[object Object]")
       - Single-file build incompatibility (React chunks may not inline)
       - Performance regression (React reconciliation overhead)
       - Bundle size increase (~140KB baseline)

    2. **Project Risks**
       - Scope creep (migration takes longer than estimated)
       - Feature regression (functionality lost during migration)
       - Knowledge gap (team unfamiliar with React patterns)
       - Testing gaps (insufficient coverage during migration)
       - Parallel development conflict (changes needed during migration)

    3. **Business Risks**
       - Downtime during migration
       - User confusion if UI changes
       - Opportunity cost (time spent migrating vs new features)

    **For each risk, document:**
    - Description: What could go wrong
    - Likelihood: Low (1) / Medium (2) / High (3)
    - Impact: Low (1) / Medium (2) / High (3)
    - Risk Score: Likelihood x Impact
    - Mitigation: How to reduce likelihood
    - Contingency: What to do if it happens
    - Owner: Who monitors this risk

    **Risk Response Strategies:**
    - Avoid: Don't migrate (recommendation from research)
    - Mitigate: Incremental migration with rollback points
    - Transfer: Use well-tested libraries (react-chartjs-2, dexie-react-hooks)
    - Accept: Bundle size increase is acceptable trade-off

    **Open Questions from Research:**
    Document the 5 open questions from 30-RESEARCH.md and their risk implications:
    1. Single-file build compatibility
    2. Migration effort multiplier for complex components
    3. Performance comparison
    4. PWA compatibility
    5. Event system migration complexity

    Format as markdown with risk matrix table, detailed risk descriptions, and mitigation plans.
  </action>
  <verify>
    - File contains risk matrix table with scores
    - All technical risks from research are documented
    - Each risk has mitigation and contingency plans
    - Open questions from research are addressed
    - File includes overall risk summary
  </verify>
  <done>
    30-RISK-ASSESSMENT.md exists with:
    - Risk matrix with likelihood/impact scores
    - 10+ identified risks across technical/project/business categories
    - Mitigation strategies for each risk
    - Contingency plans for high-impact risks
    - Open questions documented with risk implications
  </done>
</task>

</tasks>

<verification>
- Both documents exist in .planning/phases/30-react-migration-research/
- Migration strategy covers all 5 technical areas from success criteria
- Risk assessment has formal matrix with scores
- Documents are actionable (not just theoretical)
</verification>

<success_criteria>
- Success criteria #3 met: Shadow DOM migration strategy defined
- Success criteria #4 met: Chart.js integration path documented
- Success criteria #5 met: Web Worker compatibility verified
- Success criteria #6 met: Testing migration path documented
- Success criteria #7 met: Risk assessment completed with mitigations
</success_criteria>

<output>
After completion, create `.planning/phases/30-react-migration-research/30-02-SUMMARY.md`
</output>
